{"config":{"lang":["en"],"separator":"[\\s\\-\\.]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Doctrine Doctor","text":"<p> Runtime Analysis Tool for Doctrine ORM \u2014 Integrated into Symfony Web Profiler </p> <p> </p>"},{"location":"#why-runtime-analysis","title":"Why Runtime Analysis?","text":"<p>Unlike static analysis tools (PHPStan, Psalm) that analyze code without execution, Doctrine Doctor:</p> <ul> <li>Detects runtime-only issues: N+1 queries, actual query performance, missing indexes on real database</li> <li>Analyzes real execution context: Actual parameter values, data volumes, execution plans</li> <li>Integrated into your workflow: Results appear directly in Symfony Web Profiler during development</li> <li>\ud83d\udccd Backtrace: Points to exact template line</li> <li>\ud83d\udca1 Suggestion: Use <code>-&gt;addSelect(..)</code> to eager load authors</li> </ul> <p> </p>"},{"location":"#features","title":"Features","text":""},{"location":"#66-specialized-analyzers","title":"66 Specialized Analyzers","text":"<ul> <li> <p>Performance \u2014 Detects N+1 queries, missing database indexes, slow queries, excessive hydration,   findAll() without limits, setMaxResults() with collection joins, too many JOINs, and query caching   opportunities</p> </li> <li> <p>Security \u2014 Identifies DQL/SQL injection vulnerabilities, QueryBuilder SQL injection risks,   sensitive data exposure in serialization, unprotected sensitive fields, and insecure random generators</p> </li> <li> <p>Code Quality \u2014 Detects cascade configuration issues, bidirectional inconsistencies,   missing orphan removal, type mismatches, float usage for money, uninitialized collections,   EntityManager in entities, and architectural violations</p> </li> <li> <p>Configuration \u2014 Validates database charset/collation settings, timezone handling,   Gedmo trait configurations, MySQL strict mode, and other database-level configurations</p> </li> </ul>"},{"location":"#quick-start-30-seconds","title":"\u26a1 Quick Start (30 seconds)","text":"<p>Step 1: Install</p> <pre><code>composer require --dev ahmed-bhs/doctrine-doctor\n</code></pre> <p>Step 2: That's it!</p> <p>Auto-configured via Symfony Flex. No YAML, no configuration files needed.</p> <p>Step 3: See it in action</p> <ol> <li>Refresh any page in your Symfony app (in <code>dev</code> environment)</li> <li>Open the Symfony Web Profiler (bottom toolbar)</li> <li>Click the \"Doctrine Doctor\" panel \ud83e\ude7a</li> </ol>"},{"location":"#configuration-optional","title":"Configuration (Optional)","text":"<p>Configure thresholds in <code>config/packages/dev/doctrine_doctor.yaml</code>:</p> <pre><code>doctrine_doctor:\n    analyzers:\n        n_plus_one:\n            threshold: 5  # default, lower to 3 to be stricter\n        slow_query:\n            threshold: 100  # milliseconds (default)\n</code></pre> <p>Enable backtraces to see WHERE in your code issues originate:</p> <pre><code># config/packages/dev/doctrine.yaml\ndoctrine:\n    dbal:\n        profiling_collect_backtrace: true\n</code></pre> <p>Full configuration reference \u2192</p>"},{"location":"#example-n1-query-detection","title":"Example: N+1 Query Detection","text":"ProblemDetectionSolution <p>Template triggers lazy loading</p> <pre><code>// Controller\n$users = $repository-&gt;findAll();\n\n// Template\n{% for user in users %}\n    {{ user.profile.bio }}\n{% endfor %}\n</code></pre> <p>Triggers 100 queries</p> <p>Doctrine Doctor detects N+1</p> <ul> <li>100 queries instead of 1</li> <li>Shows exact query count, execution time</li> <li>Suggests eager loading</li> </ul> <p>Real-time detection</p> <p>Eager load with JOIN</p> <pre><code>$users = $repository\n    -&gt;createQueryBuilder('u')\n    -&gt;leftJoin('u.profile', 'p')\n    -&gt;addSelect('p')\n    -&gt;getQuery()\n    -&gt;getResult();\n</code></pre> <p>Single query</p>"},{"location":"#documentation","title":"Documentation","text":"Document Description Configuration Reference Comprehensive guide to all configuration options - customize analyzers, thresholds, and outputs to match your workflow Full Analyzers List Complete catalog of all 66 analyzers covering performance, security, code quality, and configuration Architecture Guide Deep dive into system design, architecture patterns, and technical internals Template Security Essential security best practices for PHP templates - prevent XSS attacks and ensure safe template rendering"},{"location":"#contributing","title":"Contributing","text":"<p>We welcome contributions! See our Contributing Guide for details.</p>"},{"location":"#license","title":"License","text":"<p>MIT License - see LICENSE for details.</p> <p> Created by Ahmed EBEN HASSINE </p> <p> </p>"},{"location":"ANALYZERS/","title":"Analyzer Reference Documentation","text":""},{"location":"ANALYZERS/#table-of-contents","title":"Table of Contents","text":"<ul> <li>1. Overview</li> <li>2. Analyzer Taxonomy</li> <li>3. Performance Analyzers</li> <li>4. Security Analyzers</li> <li>5. Integrity Analyzers</li> <li>6. Configuration Analyzers</li> <li>7. Configuration</li> <li>8. Extensibility</li> </ul>"},{"location":"ANALYZERS/#1-overview","title":"1. Overview","text":"<p>Doctrine Doctor implements 66 specialized analyzers organized into four categories that detect Doctrine ORM anti-patterns and performance issues.</p>"},{"location":"ANALYZERS/#11-severity-classification","title":"1.1 Severity Classification","text":"Severity Impact Examples Critical Security vulnerabilities or data loss risk SQL injection, cascade misconfiguration High Major performance degradation (&gt;50%) N+1 queries, missing indexes Medium Sub-optimal patterns with measurable impact Inefficient hydration, architectural issues Low Minor improvements Naming conventions, code style"},{"location":"ANALYZERS/#2-analyzer-taxonomy","title":"2. Analyzer Taxonomy","text":""},{"location":"ANALYZERS/#21-distribution-by-category","title":"2.1 Distribution by Category","text":""},{"location":"ANALYZERS/#22-detection-methods","title":"2.2 Detection Methods","text":"<ul> <li>Static Analysis: Entity metadata, configuration analysis</li> <li>Runtime Analysis: Query pattern recognition, signature matching</li> <li>Database Analysis: EXPLAIN query execution plans</li> <li>Code Analysis: Call stack inspection, trace analysis</li> </ul>"},{"location":"ANALYZERS/#3-performance-analyzers","title":"3. Performance Analyzers","text":""},{"location":"ANALYZERS/#31-category-overview","title":"3.1 Category Overview","text":"<p>Performance analyzers detect patterns that degrade application responsiveness, increase database load, or consume excessive system resources.</p> <p>Total: 25 analyzers Average Impact: 10-1000x performance improvement when resolved</p>"},{"location":"ANALYZERS/#32-analyzer-catalog","title":"3.2 Analyzer Catalog","text":""},{"location":"ANALYZERS/#32-key-performance-analyzers","title":"3.2 Key Performance Analyzers","text":""},{"location":"ANALYZERS/#321-nplusoneanalyzer","title":"3.2.1 NPlusOneAnalyzer","text":"<ul> <li>Severity: Critical</li> <li>Purpose: Detects N+1 query problems (1 initial query + N lazy-loaded queries)</li> <li>Detection: Query signature matching and execution pattern analysis</li> <li>Impact: 90-99% query reduction when fixed</li> </ul>"},{"location":"ANALYZERS/#322-missingindexanalyzer","title":"3.2.2 MissingIndexAnalyzer","text":"<ul> <li>Severity: Critical</li> <li>Purpose: Identifies queries doing full table scans</li> <li>Detection: Database EXPLAIN plan analysis</li> <li>Impact: 10-1000x performance improvement</li> </ul>"},{"location":"ANALYZERS/#323-flushinloopanalyzer","title":"3.2.3 FlushInLoopAnalyzer","text":"<ul> <li>Severity: Critical</li> <li>Purpose: Finds EntityManager::flush() calls inside loops</li> <li>Detection: Call stack trace analysis</li> <li>Impact: 10-100x improvement by batching operations</li> </ul>"},{"location":"ANALYZERS/#324-slowqueryanalyzer","title":"3.2.4 SlowQueryAnalyzer","text":"<ul> <li>Severity: High</li> <li>Purpose: Flags queries exceeding execution time threshold</li> <li>Detection: Direct execution time measurement</li> </ul>"},{"location":"ANALYZERS/#325-hydrationanalyzer","title":"3.2.5 HydrationAnalyzer","text":"<ul> <li>Severity: Medium</li> <li>Purpose: Detects inefficient result set hydration</li> <li>Impact: 50-80% memory reduction</li> </ul>"},{"location":"ANALYZERS/#326-nestedrelationshipn1analyzer","title":"3.2.6 NestedRelationshipN1Analyzer","text":"<ul> <li>Severity: Critical</li> <li>Purpose: Detects nested N+1 queries (multi-level lazy loading chains)</li> <li>Detection: Query chain pattern analysis tracking foreign key relationships</li> <li>Impact: Prevents exponential query growth (N\u00d7M queries for 2-level nesting)</li> <li>Example: <code>$article-&gt;getAuthor()-&gt;getCountry()</code> creates N+1 for authors AND N+1 for countries</li> </ul>"},{"location":"ANALYZERS/#327-unusedeagerloadanalyzer","title":"3.2.7 UnusedEagerLoadAnalyzer","text":"<ul> <li>Severity: High</li> <li>Purpose: Detects JOIN FETCH where joined data is never accessed</li> <li>Detection: Analyzes SELECT/WHERE/ORDER BY clauses for unused table aliases</li> <li>Impact: 30-70% memory reduction, faster hydration, reduced bandwidth</li> <li>Example: <code>SELECT a FROM Article a JOIN a.author</code> but never uses author data</li> </ul>"},{"location":"ANALYZERS/#328-flushinloopanalyzermodern","title":"3.2.8 FlushInLoopAnalyzerModern","text":"<ul> <li>Severity: Critical</li> <li>Purpose: Modern implementation of flush-in-loop detection using factory pattern</li> <li>Detection: Temporal analysis of flush() calls with improved architecture</li> <li>Impact: Same as FlushInLoopAnalyzer (10-100x improvement)</li> <li>Note: Refactored version with better separation of concerns</li> </ul>"},{"location":"ANALYZERS/#33-performance-analyzer-summary-table","title":"3.3 Performance Analyzer Summary Table","text":"Analyzer ID Detection Method Typical Impact Configuration NPlusOneAnalyzer Query signature matching 90-99% query reduction <code>threshold: 5</code> MissingIndexAnalyzer EXPLAIN analysis 10-1000x speedup <code>slow_query_threshold: 50</code> SlowQueryAnalyzer Execution time Direct <code>threshold: 100</code> (ms) HydrationAnalyzer Result set size 50-80% memory reduction <code>row_threshold: 99</code> FlushInLoopAnalyzer Trace analysis 10-100x <code>flush_count_threshold: 5</code> EagerLoadingAnalyzer JOIN count Query optimization <code>join_threshold: 5</code> LazyLoadingAnalyzer Proxy initialization Query reduction <code>threshold: 10</code> DTOHydrationAnalyzer Hydration mode Memory + performance \u2014 BulkOperationAnalyzer Entity count 100-1000x <code>threshold: 100</code> ConnectionPoolingAnalyzer Connection usage Scaling Platform-dependent QueryCachingOpportunityAnalyzer Cache statistics 50-90% reduction \u2014 EntityManagerClearAnalyzer Memory usage Memory leak prevention <code>batch_size_threshold: 100</code> JoinOptimizationAnalyzer JOIN complexity Query simplification <code>max_joins: 5</code> JoinTypeConsistencyAnalyzer JOIN + WHERE patterns Semantic clarity \u2014 SetMaxResultsWithCollectionJoinAnalyzer LIMIT + JOIN Incorrect results \u2014 PartialObjectAnalyzer SELECT clause Memory reduction <code>threshold: 5</code> OrderByWithoutLimitAnalyzer ORDER BY + full scan Resource usage \u2014 FindAllAnalyzer Unfiltered queries Memory exhaustion <code>threshold: 99</code> YearFunctionOptimizationAnalyzer Function in WHERE Index usage \u2014 IneffectiveLikeAnalyzer Leading wildcard Full table scan \u2014 DivisionByZeroAnalyzer Division operations Runtime errors \u2014 NullComparisonAnalyzer NULL handling Index effectiveness \u2014 CollectionEmptyAccessAnalyzer Uninitialized collections Lazy load prevention \u2014 AutoGenerateProxyClassesAnalyzer Configuration Production readiness \u2014 DoctrineCacheAnalyzer Cache configuration Deprecation warnings \u2014 NestedRelationshipN1Analyzer Query chain analysis Exponential query prevention <code>nesting_threshold: 2</code> UnusedEagerLoadAnalyzer Alias usage analysis 30-70% memory reduction \u2014 <p>Internal Parser Utilities (not directly user-facing): | SqlAggregationAnalyzer | Aggregation function analysis | Query optimization | Internal | | SqlConditionAnalyzer | WHERE/ON clause analysis | Index effectiveness | Internal | | SqlPerformanceAnalyzer | SQL pattern analysis | Performance insights | Internal |</p>"},{"location":"ANALYZERS/#4-security-analyzers","title":"4. Security Analyzers","text":""},{"location":"ANALYZERS/#41-category-overview","title":"4.1 Category Overview","text":"<p>Security analyzers detect vulnerabilities aligned with OWASP Top 10 and Doctrine-specific attack vectors.</p> <p>Total: 4 analyzers OWASP Coverage: A02:2021 (Cryptographic Failures), A03:2021 (Injection), A05:2021 (Security Misconfiguration)</p>"},{"location":"ANALYZERS/#42-key-security-analyzers","title":"4.2 Key Security Analyzers","text":""},{"location":"ANALYZERS/#421-dqlinjectionanalyzer","title":"4.2.1 DQLInjectionAnalyzer","text":"<ul> <li>Severity: Critical</li> <li>OWASP: A03:2021 Injection</li> <li>Purpose: Detects DQL injection vulnerabilities in string concatenation</li> <li>Detection: AST analysis of DQL string construction</li> </ul>"},{"location":"ANALYZERS/#422-sqlinjectioninrawqueriesanalyzer","title":"4.2.2 SQLInjectionInRawQueriesAnalyzer","text":"<ul> <li>Severity: Critical</li> <li>OWASP: A03:2021 Injection</li> <li>Purpose: Finds SQL injection in native queries</li> <li>Detection: Native query pattern analysis</li> </ul>"},{"location":"ANALYZERS/#423-sensitivedataexposureanalyzer","title":"4.2.3 SensitiveDataExposureAnalyzer","text":"<ul> <li>Severity: Critical</li> <li>OWASP: A02:2021 Cryptographic Failures</li> <li>Purpose: Detects sensitive fields exposed in serialization</li> <li>Detection: Field pattern matching (password, token, secret, api_key)</li> </ul>"},{"location":"ANALYZERS/#424-insecurerandomanalyzer","title":"4.2.4 InsecureRandomAnalyzer","text":"<ul> <li>Severity: Medium</li> <li>Purpose: Identifies insecure random number generation</li> <li>Detection: Usage of <code>rand()</code> in security contexts</li> </ul>"},{"location":"ANALYZERS/#5-integrity-analyzers","title":"5. Integrity Analyzers","text":""},{"location":"ANALYZERS/#51-category-overview","title":"5.1 Category Overview","text":"<p>Code Quality analyzers detect code smells, anti-patterns, and violations of best practices that affect maintainability, readability, and adherence to Doctrine ORM conventions.</p> <p>Total: 29 analyzers Focus: Type safety, relationship consistency, lifecycle management, naming conventions</p>"},{"location":"ANALYZERS/#52-key-analyzers","title":"5.2 Key Analyzers","text":""},{"location":"ANALYZERS/#521-cascadeanalyzer-unified","title":"5.2.1 CascadeAnalyzer (Unified)","text":"<p>Description: Single unified analyzer for all cascade-related issues following Single Responsibility Principle.</p> <p>Detects:</p> <ol> <li><code>cascade=\"all\"</code> usage (highest priority - most dangerous)</li> <li><code>cascade=\"remove\"</code> on independent entities (potential data loss)</li> <li><code>cascade=\"persist\"</code> on independent entities (wrong aggregate boundaries)</li> </ol> <p>Benefits:</p> <ul> <li>O(n) performance instead of O(3n)</li> <li>No duplicate issues</li> <li>Clear priority ordering</li> </ul> <p>Example Violation:</p> <pre><code>/**\n * @ORM\\ManyToOne(targetEntity=\"Tag\")\n * @ORM\\JoinColumn(cascade={\"remove\"})  // \u274c Tag is independent!\n */\nprivate Tag $tag;\n</code></pre> <p>Issue: Deleting article would delete shared tag \u2192 data loss</p>"},{"location":"ANALYZERS/#522-cascadeconfigurationanalyzer","title":"5.2.2 CascadeConfigurationAnalyzer","text":"<p>Description: Validates consistency between ORM cascade operations and database foreign key constraints.</p> <p>Violation Example:</p> <pre><code>/**\n * @ORM\\OneToMany(targetEntity=\"Item\", mappedBy=\"order\", cascade={\"remove\"})\n */\nprivate Collection $items;\n\n// Database: ON DELETE SET NULL (mismatch!)\n</code></pre> <p>Issue: ORM expects cascade delete, database sets NULL \u2192 inconsistent state</p>"},{"location":"ANALYZERS/#522-bidirectionalconsistencyanalyzer","title":"5.2.2 BidirectionalConsistencyAnalyzer","text":"<p>Description: Ensures symmetric mapping in bidirectional relationships.</p> <p>Violation:</p> <pre><code>class Order {\n    /** @ORM\\ManyToOne(targetEntity=\"Customer\", inversedBy=\"orders\") */\n    private Customer $customer;\n}\n\nclass Customer {\n    /** @ORM\\OneToMany(targetEntity=\"Order\", mappedBy=\"wrongField\") */\n    //                                               \u2191 Should be \"customer\"\n    private Collection $orders;\n}\n</code></pre>"},{"location":"ANALYZERS/#53-code-quality-analyzer-summary","title":"5.3 Code Quality Analyzer Summary","text":"Analyzer Focus Area Violation Type Impact BidirectionalConsistencyAnalyzer Relationship symmetry Mapping error ORM malfunction CascadeConfigurationAnalyzer Aggregate consistency ORM/DB mismatch Data corruption CascadeAllAnalyzer Explicit design Over-automation Unintended side effects CascadePersistOnIndependentEntityAnalyzer Aggregate boundaries Wrong cascade scope Data integrity CascadeRemoveOnIndependentEntityAnalyzer Entity independence Improper deletion Data loss OrphanRemovalWithoutCascadeRemoveAnalyzer Lifecycle management Configuration inconsistency Memory leak MissingOrphanRemovalOnCompositionAnalyzer Composition pattern Missing cleanup Orphaned records OnDeleteCascadeMismatchAnalyzer Layer consistency ORM vs DB conflict Undefined behavior ForeignKeyMappingAnalyzer Referential integrity Primitive FK exposure Architecture violation TransactionBoundaryAnalyzer ACID compliance Transaction scope Data inconsistency EntityStateConsistencyAnalyzer UnitOfWork pattern State management Sync issues FinalEntityAnalyzer Proxy compatibility Non-final entities Proxy failures EmbeddableMutabilityAnalyzer Value object Mutable embeddables Side effects EmbeddableWithoutValueObjectAnalyzer Value object pattern Missing VO semantics Design smell MissingEmbeddableOpportunityAnalyzer Cohesion Scattered value objects Maintainability DecimalPrecisionAnalyzer Type system Precision loss Financial errors FloatForMoneyAnalyzer Type system Floating-point rounding Calculation errors FloatInMoneyEmbeddableAnalyzer Value objects Incorrect money handling Financial bugs PropertyTypeMismatchAnalyzer Type safety PHP\u2194DB type mismatch Runtime errors ColumnTypeAnalyzer Column definitions Wrong type usage Data loss CollectionInitializationAnalyzer Object lifecycle Uninitialized collections Null pointer exceptions GetReferenceAnalyzer Performance Unnecessary queries Database overhead PrimaryKeyStrategyAnalyzer ID generation Inefficient strategy Performance issues QueryBuilderBestPracticesAnalyzer Code quality Bad QueryBuilder patterns Maintainability EntityManagerInEntityAnalyzer Architecture Dependency injection Architecture violation TypeHintMismatchAnalyzer Type safety Type inconsistency Runtime errors NamingConventionAnalyzer Code standards Naming violations Readability issues"},{"location":"ANALYZERS/#6-configuration-analyzers","title":"6. Configuration Analyzers","text":""},{"location":"ANALYZERS/#61-key-configuration-analyzers","title":"6.1 Key Configuration Analyzers","text":""},{"location":"ANALYZERS/#611-timezoneanalyzer","title":"6.1.1 TimeZoneAnalyzer","text":"<ul> <li>Purpose: Detects timezone handling issues in datetime fields</li> <li>Recommendation: Use DateTimeImmutable with UTC timezone</li> </ul>"},{"location":"ANALYZERS/#612-gedmo-extension-analyzers","title":"6.1.2 Gedmo Extension Analyzers","text":"<ul> <li>TimestampableTraitAnalyzer: Validates timestampable trait configuration</li> <li>BlameableTraitAnalyzer: Ensures proper user tracking setup</li> <li>SoftDeleteableTraitAnalyzer: Validates soft delete configuration</li> </ul>"},{"location":"ANALYZERS/#613-database-configuration","title":"6.1.3 Database Configuration","text":"<ul> <li>CharsetAnalyzer: Detects charset issues (recommends UTF8MB4)</li> <li>CollationAnalyzer: Validates collation settings for proper sorting</li> <li>MySQL/MariaDB: Detects utf8mb4_general_ci vs utf8mb4_unicode_ci, collation mismatches</li> <li>PostgreSQL: Detects \"C\" collation issues, libc vs ICU collations, FK collation mismatches</li> <li>Platform-specific recommendations for optimal sorting accuracy</li> <li>StrictModeAnalyzer: Ensures MySQL strict mode is enabled</li> <li>InnoDBEngineAnalyzer: Validates InnoDB storage engine usage</li> </ul>"},{"location":"ANALYZERS/#62-configuration-summary","title":"6.2 Configuration Summary","text":"Focus Area Analyzers Key Recommendations Timezone TimeZoneAnalyzer Use UTC + DateTimeImmutable Gedmo Traits 3 analyzers Proper trait configuration Database Setup 4 analyzers UTF8MB4 charset + strict mode + InnoDB"},{"location":"ANALYZERS/#7-configuration","title":"7. Configuration","text":""},{"location":"ANALYZERS/#71-basic-configuration","title":"7.1 Basic Configuration","text":"<pre><code>doctrine_doctor:\n    enabled: true\n    profiler:\n        show_in_toolbar: true\n        show_debug_info: false\n</code></pre>"},{"location":"ANALYZERS/#72-analyzer-configuration","title":"7.2 Analyzer Configuration","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        n_plus_one:\n            enabled: true\n            threshold: 5\n        slow_query:\n            enabled: true\n            threshold: 100  # milliseconds\n        missing_index:\n            enabled: true\n            slow_query_threshold: 50\n</code></pre>"},{"location":"ANALYZERS/#73-category-configuration","title":"7.3 Category Configuration","text":"<pre><code>doctrine_doctor:\n    groups:\n        performance: true\n        security: true\n        integrity: true\n        configuration: true\n</code></pre>"},{"location":"ANALYZERS/#8-extensibility","title":"8. Extensibility","text":""},{"location":"ANALYZERS/#81-custom-analyzers","title":"8.1 Custom Analyzers","text":"<p>Create custom analyzers by implementing <code>AnalyzerInterface</code>:</p> <pre><code>use AhmedBhs\\DoctrineDoctor\\Analyzer\\AnalyzerInterface;\n\nfinal class CustomAnalyzer implements AnalyzerInterface\n{\n    public function analyze(QueryDataCollection $queries): iterable\n    {\n        // Custom detection logic\n    }\n}\n</code></pre>"},{"location":"ANALYZERS/#82-registration","title":"8.2 Registration","text":"<pre><code>services:\n    App\\Analyzer\\CustomAnalyzer:\n        tags:\n            - { name: 'doctrine_doctor.analyzer' }\n</code></pre> <p>\u2190 Back to Main Documentation | Configuration \u2192</p>"},{"location":"ARCHITECTURE/","title":"System Architecture","text":""},{"location":"ARCHITECTURE/#table-of-contents","title":"Table of Contents","text":"<ul> <li>1. Overview</li> <li>2. Architectural Patterns</li> <li>3. Component Diagram</li> <li>4. Analysis Lifecycle Diagram</li> <li>5. Class Structure</li> <li>6. Design Decisions</li> <li>7. Extension Points</li> </ul>"},{"location":"ARCHITECTURE/#1-overview","title":"1. Overview","text":"<p>Doctrine Doctor follows a layered architecture pattern with clear separation of concerns:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           Presentation Layer                 \u2502\n\u2502   (Symfony Web Profiler Integration)        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Application Layer                   \u2502\n\u2502  (Data Collectors, Issue Reconstructors)     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           Domain Layer                       \u2502\n\u2502   (Analyzers, Issues, Suggestions)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502       Infrastructure Layer                   \u2502\n\u2502  (Doctrine ORM, Database, Templates)         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"ARCHITECTURE/#11-layer-responsibilities","title":"1.1 Layer Responsibilities","text":""},{"location":"ARCHITECTURE/#presentation-layer","title":"Presentation Layer","text":"<ul> <li>Symfony Profiler panel rendering</li> <li>Twig template integration</li> <li>Visual representation of analysis results</li> </ul>"},{"location":"ARCHITECTURE/#application-layer","title":"Application Layer","text":"<ul> <li>Query data collection</li> <li>Analysis coordination</li> <li>Issue aggregation and deduplication</li> <li>Service orchestration</li> </ul>"},{"location":"ARCHITECTURE/#domain-layer","title":"Domain Layer","text":"<ul> <li>Core analysis algorithms</li> <li>Business logic for issue detection</li> <li>Suggestion generation</li> <li>Domain models (Issue, Suggestion, QueryData)</li> </ul>"},{"location":"ARCHITECTURE/#infrastructure-layer","title":"Infrastructure Layer","text":"<ul> <li>Doctrine ORM integration</li> <li>Database platform abstraction</li> <li>PHP template rendering system</li> <li>External service integrations</li> </ul>"},{"location":"ARCHITECTURE/#2-architectural-patterns","title":"2. Architectural Patterns","text":""},{"location":"ARCHITECTURE/#21-strategy-pattern-analyzers","title":"2.1 Strategy Pattern (Analyzers)","text":"<p>Each analyzer implements the <code>AnalyzerInterface</code>, enabling runtime composition. This pattern provides:</p> <ul> <li>Open/Closed Principle compliance - Add new analyzers without modifying existing code</li> <li>Easy addition of new analyzers - Simply implement the interface and tag the service</li> <li>Independent testing - Each analyzer can be tested in isolation</li> <li>Dynamic analyzer selection - Enable/disable analyzers via configuration</li> </ul>"},{"location":"ARCHITECTURE/#22-template-method-pattern-analysis-pipeline","title":"2.2 Template Method Pattern (Analysis Pipeline)","text":"<p>The analysis process follows a defined template implemented by Symfony's <code>DataCollector</code> and <code>LateDataCollectorInterface</code>:</p> <ol> <li>collect() - Capture raw query data (fast, ~1-2ms, runs during request)</li> <li>lateCollect() - Perform heavy analysis (10-50ms, runs AFTER response sent)</li> <li>serialize() - Prepare analysis results for storage/display</li> <li>unserialize() - Restore analysis results from cache</li> </ol> <p>This pattern ensures analysis overhead doesn't impact request time metrics.</p>"},{"location":"ARCHITECTURE/#23-issue-creation-pattern","title":"2.3 Issue Creation Pattern","text":"<p>Each analyzer creates <code>Issue</code> objects with:</p> <ul> <li>Severity (Critical, High, Medium, Low)</li> <li>Category (Performance, Security, Code Quality, Configuration)</li> <li>Suggestion (with code examples and descriptions)</li> <li>Location (backtrace, query context)</li> <li>Metadata (queries, execution time, affected entities)</li> </ul>"},{"location":"ARCHITECTURE/#24-dependency-inversion-principle","title":"2.4 Dependency Inversion Principle","text":"<p>High-level modules depend on abstractions, not concrete implementations:</p> <ul> <li>Analyzers depend on <code>TemplateRendererInterface</code>, not specific renderers</li> <li>DoctrineDoctorDataCollector depends on <code>AnalyzerInterface[]</code>, not concrete analyzers</li> <li>Template rendering uses <code>TemplateRendererInterface</code> (implemented by <code>PhpTemplateRenderer</code> or <code>TwigTemplateRenderer</code>)</li> </ul> <p>This allows easy substitution of implementations without changing high-level code.</p>"},{"location":"ARCHITECTURE/#3-component-diagram","title":"3. Component Diagram","text":"<pre><code>graph TB\n    subgraph \"Symfony Application\"\n        A[HTTP Request] --&gt; B[Controller]\n        B --&gt; C[Doctrine ORM]\n    end\n\n    subgraph \"Doctrine Bundle\"\n        C --&gt; D[DoctrineDataCollector]\n    end\n\n    subgraph \"Doctrine Doctor Bundle\"\n        D --&gt; E[DoctrineDoctorDataCollector]\n        E --&gt; F[ServiceHolder]\n\n        F --&gt; G[analyzeQueriesLazy]\n        G --&gt; H1[Performance Analyzers]\n        G --&gt; H2[Security Analyzers]\n        G --&gt; H3[Integrity Analyzers]\n        G --&gt; H4[Configuration Analyzers]\n\n        H1 --&gt; I[Issues]\n        H2 --&gt; I\n        H3 --&gt; I\n        H4 --&gt; I\n\n        I --&gt; J[IssueDeduplicator]\n        J --&gt; K[Profiler Panel]\n    end\n\n    style A fill:#e1f5ff\n    style E fill:#fff4e1\n    style G fill:#ffe1e1\n    style K fill:#e1ffe1</code></pre>"},{"location":"ARCHITECTURE/#4-analysis-lifecycle-diagram","title":"4. Analysis Lifecycle Diagram","text":"<pre><code>sequenceDiagram\n    participant Request\n    participant Symfony\n    participant DoctrineDC\n    participant DoctorDC\n    participant Analyzers\n    participant Profiler\n\n    Request-&gt;&gt;Symfony: HTTP Request\n    activate Symfony\n\n    Symfony-&gt;&gt;DoctrineDC: Execute queries\n    DoctrineDC-&gt;&gt;DoctrineDC: Log queries\n\n    Symfony-&gt;&gt;DoctorDC: collect()\n    activate DoctorDC\n    DoctorDC-&gt;&gt;DoctrineDC: Get query data\n    DoctrineDC--&gt;&gt;DoctorDC: Query metadata\n    DoctorDC-&gt;&gt;DoctorDC: Store in $data\n    deactivate DoctorDC\n\n    Symfony--&gt;&gt;Request: Response sent \u2713\n    deactivate Symfony\n\n    Note over DoctorDC,Analyzers: Post-response analysis\n\n    DoctorDC-&gt;&gt;DoctorDC: lateCollect()\n    activate DoctorDC\n\n    loop For each analyzer\n        DoctorDC-&gt;&gt;Analyzers: analyze(QueryDataCollection)\n        Analyzers-&gt;&gt;Analyzers: Detect patterns\n        Analyzers--&gt;&gt;DoctorDC: Return IssueCollection\n    end\n\n    DoctorDC-&gt;&gt;DoctorDC: Deduplicate issues\n    DoctorDC-&gt;&gt;DoctorDC: Calculate statistics\n    deactivate DoctorDC\n\n    Profiler-&gt;&gt;DoctorDC: getData()\n    DoctorDC--&gt;&gt;Profiler: Analysis results\n    Profiler-&gt;&gt;Profiler: Render UI</code></pre>"},{"location":"ARCHITECTURE/#5-class-structure","title":"5. Class Structure","text":""},{"location":"ARCHITECTURE/#51-core-interfaces","title":"5.1 Core Interfaces","text":"<pre><code>/**\n * Analyzer Interface - Strategy Pattern\n */\ninterface AnalyzerInterface\n{\n    /**\n     * Analyze queries and return issues.\n     *\n     * @param QueryDataCollection $queryDataCollection Collected query data\n     * @return IssueCollection Collection of detected issues\n     */\n    public function analyze(QueryDataCollection $queryDataCollection): IssueCollection;\n}\n\n/**\n * Template Renderer Interface - Dependency Inversion\n */\ninterface TemplateRendererInterface\n{\n    /**\n     * Render a template with given context.\n     *\n     * @param string $templateName Name/identifier of the template\n     * @param array&lt;string, mixed&gt; $context Variables to pass to the template\n     * @throws \\RuntimeException If template not found or rendering fails\n     * @return array{code: string, description: string} Rendered code and description\n     */\n    public function render(string $templateName, array $context): array;\n\n    /**\n     * Check if a template exists.\n     */\n    public function exists(string $templateName): bool;\n}\n\n/**\n * Issue Interface - Domain Model\n */\ninterface IssueInterface\n{\n    public function getType(): string;\n    public function getTitle(): string;\n    public function getDescription(): string;\n    public function getSeverity(): Severity;\n    public function getCategory(): string;\n    public function getSuggestion(): ?SuggestionInterface;\n    public function getBacktrace(): ?array;\n    public function getQueries(): array;\n    public function getData(): array;\n    public function toArray(): array;\n}\n</code></pre>"},{"location":"ARCHITECTURE/#52-class-diagram","title":"5.2 Class Diagram","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   DoctrineDoctorDataCollector   \u2502\n\u2502   extends DataCollector          \u2502\n\u2502   implements LateDataCollector   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 - analyzers: AnalyzerInterface[]\u2502\n\u2502 - helpers: DataCollectorHelpers  \u2502\n\u2502 - doctrineCollector              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 + collect(Request, Response)     \u2502\n\u2502 + lateCollect()                  \u2502\n\u2502 + getData(): array               \u2502\n\u2502 + getName(): string              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502 uses\n             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      DataCollectorHelpers       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 - databaseInfoCollector          \u2502\n\u2502 - issueReconstructor             \u2502\n\u2502 - queryStatsCalculator           \u2502\n\u2502 - dataCollectorLogger            \u2502\n\u2502 - issueDeduplicator              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u2502 coordinates\n             \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      AnalyzerInterface          \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524           \u2502\n\u2502 + analyze(QueryDataCollection)  \u2502           \u2502\n\u2502   : IssueCollection              \u2502           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502\n             \u25b3                                 \u2502\n             \u2502 implements                      \u2502\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u2502\n     \u2502                \u2502               \u2502       \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502N+1     \u2502    \u2502SlowQuery     \u2502  \u2502Security\u2502   \u2502\n\u2502Analyzer\u2502    \u2502Analyzer      \u2502  \u2502Analyzer\u2502   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n                                              \u2502\n                                        uses  \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u2502\n\u2502     TemplateRendererInterface   \u2502\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 + render(name, ctx): array      \u2502\n\u2502 + exists(name): bool            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n             \u25b3\n             \u2502 implements\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502                \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502PhpTemplate \u2502  \u2502TwigTemplate  \u2502\n\u2502Renderer    \u2502  \u2502Renderer      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"ARCHITECTURE/#6-design-decisions","title":"6. Design Decisions","text":""},{"location":"ARCHITECTURE/#61-late-data-collection","title":"6.1 Late Data Collection","text":"<p>Decision: Implement <code>LateDataCollectorInterface</code> for analysis execution.</p> <p>Rationale:</p> <ul> <li>Analysis overhead not included in request time metrics</li> <li>Heavy operations (EXPLAIN queries, entity metadata inspection) deferred</li> <li>User experience unaffected by analysis time</li> <li>Profiler data still available post-response</li> </ul> <p>Trade-offs:</p> <ul> <li>Additional complexity in service lifecycle management</li> <li>ServiceHolder pattern required for post-response DI access</li> <li>Cannot modify response based on analysis (acceptable for dev tool)</li> </ul>"},{"location":"ARCHITECTURE/#62-php-template-system","title":"6.2 PHP Template System","text":"<p>Decision: Use native PHP templates instead of solely Twig.</p> <p>Rationale:</p> <ul> <li>Flexibility: Full PHP capabilities for complex code generation</li> <li>No Twig Dependency: Core functionality works without Twig</li> <li>Performance: No template compilation overhead</li> <li>Familiarity: Standard PHP syntax for contributors</li> </ul> <p>Implementation:</p> <pre><code>// Template: left_join_with_not_null.php\n&lt;?php ob_start(); ?&gt;\n## Issue: LEFT JOIN with IS NOT NULL\n\nYour query uses LEFT JOIN but filters with IS NOT NULL:\n```sql\n&lt;?= $context-&gt;original_query ?&gt;\n```\n\nThis is contradictory. Use INNER JOIN instead.\n&lt;?php\n$code = ob_get_clean();\nreturn ['code' =&gt; $code, 'description' =&gt; 'Suggestion'];\n</code></pre> <p>Note: Templates use <code>SafeContext</code> for automatic XSS protection. See Template Security Guide for details.</p>"},{"location":"ARCHITECTURE/#63-analyzer-independence","title":"6.3 Analyzer Independence","text":"<p>Decision: Each analyzer is stateless and independent.</p> <p>Rationale:</p> <ul> <li>Parallel execution potential (future optimization)</li> <li>Independent testing and development</li> <li>Configurable enable/disable per analyzer</li> <li>No inter-analyzer dependencies</li> </ul> <p>Implementation:</p> <ul> <li>Constructor injection of dependencies only</li> <li>No shared mutable state</li> <li>Returns <code>IssueCollection</code> for type safety and predictability</li> </ul>"},{"location":"ARCHITECTURE/#64-severity-classification","title":"6.4 Severity Classification","text":"<p>Decision: Four-level severity system (Critical, High, Medium, Low).</p> <p>Rationale:</p> <ul> <li>Aligned with industry standards (CVSS, issue tracking systems)</li> <li>Clear priority communication</li> <li>Filterable in UI</li> <li>Objective criteria per analyzer</li> </ul> <p>Criteria:</p> <ul> <li>Critical: Security vulnerability, data loss risk, production failure</li> <li>High: Significant performance degradation, architectural violation</li> <li>Medium: Sub-optimal patterns, improvement opportunities</li> <li>Low: Style, cosmetic issues</li> </ul>"},{"location":"ARCHITECTURE/#7-extension-points","title":"7. Extension Points","text":""},{"location":"ARCHITECTURE/#71-custom-analyzer-registration","title":"7.1 Custom Analyzer Registration","text":"<pre><code># config/services.yaml\nservices:\n    App\\Analyzer\\CustomBusinessRuleAnalyzer:\n        arguments:\n            $threshold: 100\n        tags:\n            - { name: 'doctrine_doctor.analyzer' }\n</code></pre>"},{"location":"ARCHITECTURE/#72-custom-template-renderer","title":"7.2 Custom Template Renderer","text":"<pre><code>namespace App\\Infrastructure;\n\nuse AhmedBhs\\DoctrineDoctor\\Template\\Renderer\\TemplateRendererInterface;\n\nclass CustomTemplateRenderer implements TemplateRendererInterface\n{\n    public function render(string $templateName, array $context): array\n    {\n        // Custom rendering logic (e.g., Markdown, reStructuredText)\n    }\n}\n</code></pre> <pre><code>services:\n    App\\Infrastructure\\CustomTemplateRenderer: ~\n\n    AhmedBhs\\DoctrineDoctor\\Template\\Renderer\\TemplateRendererInterface:\n        alias: App\\Infrastructure\\CustomTemplateRenderer\n</code></pre>"},{"location":"ARCHITECTURE/#73-custom-issue-handling","title":"7.3 Custom Issue Handling","text":"<p>Extend <code>DataCollectorHelpers</code> for custom issue processing:</p> <pre><code>namespace App\\Service;\n\nuse AhmedBhs\\DoctrineDoctor\\Collector\\DataCollectorHelpers;\n\nclass CustomDataCollectorHelpers extends DataCollectorHelpers\n{\n    public function processIssues(array $issues): array\n    {\n        // Custom filtering, prioritization, or enrichment\n        return array_filter($issues, fn($issue) =&gt;\n            $this-&gt;matchesBusinessRules($issue)\n        );\n    }\n}\n</code></pre>"},{"location":"ARCHITECTURE/#references","title":"References","text":"<ul> <li>Symfony DataCollector Documentation</li> <li>Doctrine ORM Architecture</li> <li>Clean Architecture Principles</li> <li>Design Patterns: Elements of Reusable Object-Oriented Software</li> </ul> <p>\u2190 Back to Main Documentation | Configuration Reference \u2192</p>"},{"location":"CONFIGURATION/","title":"Configuration Reference","text":""},{"location":"CONFIGURATION/#table-of-contents","title":"Table of Contents","text":"<ul> <li>1. Overview</li> <li>2. Configuration Structure</li> <li>3. Global Settings</li> <li>4. Analysis Configuration</li> <li>4.1 Excluding Vendor Entities</li> <li>5. Profiler Configuration</li> <li>5.1 Profiler Visibility</li> <li>5.2 Debug Information</li> <li>5.3 Enabling Query Backtraces</li> <li>6. Analyzer Configuration</li> <li>7. Performance Thresholds</li> <li>8. Group Management</li> <li>9. Environment-Specific Configuration</li> <li>10. Advanced Configuration</li> </ul>"},{"location":"CONFIGURATION/#1-overview","title":"1. Overview","text":"<p>Doctrine Doctor uses Symfony's configuration system. All configuration is placed in YAML files under <code>config/packages/</code>.</p>"},{"location":"CONFIGURATION/#11-configuration-locations","title":"1.1 Configuration Locations","text":"<pre><code>config/\n\u251c\u2500\u2500 packages/\n\u2502   \u251c\u2500\u2500 dev/\n\u2502   \u2502   \u2514\u2500\u2500 doctrine_doctor.yaml         # Development-specific\n\u2502   \u2514\u2500\u2500 doctrine_doctor.yaml              # All environments\n</code></pre>"},{"location":"CONFIGURATION/#12-configuration-precedence","title":"1.2 Configuration Precedence","text":"<pre><code>Environment-specific (config/packages/dev/)\n    \u2193 overrides\nGlobal (config/packages/)\n    \u2193 overrides\nBundle defaults (DependencyInjection/Configuration.php)\n</code></pre>"},{"location":"CONFIGURATION/#2-configuration-structure","title":"2. Configuration Structure","text":""},{"location":"CONFIGURATION/#21-complete-configuration-tree","title":"2.1 Complete Configuration Tree","text":"<pre><code>doctrine_doctor:\n    # Master switch\n    enabled: true|false\n\n    # Profiler integration settings\n    profiler:\n        show_in_toolbar: true|false\n        show_debug_info: true|false\n\n    # Individual analyzer settings\n    analyzers:\n        analyzer_name:\n            enabled: true|false\n            # Analyzer-specific parameters\n            threshold: &lt;value&gt;\n            # ... additional parameters\n</code></pre>"},{"location":"CONFIGURATION/#22-default-values","title":"2.2 Default Values","text":"<p>When no configuration file exists, Doctrine Doctor uses these defaults:</p> <pre><code>doctrine_doctor:\n    enabled: true\n\n    profiler:\n        show_in_toolbar: true\n        show_debug_info: false\n\n    analyzers:\n        # Performance\n        n_plus_one:\n            enabled: true\n            threshold: 5\n\n        slow_query:\n            enabled: true\n            threshold: 100  # milliseconds\n\n        missing_index:\n            enabled: true\n            slow_query_threshold: 50\n            min_rows_scanned: 1000\n            explain_queries: true\n\n        # ... (see section 5 for complete list)\n</code></pre>"},{"location":"CONFIGURATION/#3-global-settings","title":"3. Global Settings","text":""},{"location":"CONFIGURATION/#31-master-enabledisable","title":"3.1 Master Enable/Disable","text":"<pre><code>doctrine_doctor:\n    enabled: true\n</code></pre> <p>Type: <code>boolean</code> Default: <code>true</code> Description: Global switch for the entire bundle. When <code>false</code>, all analyzers are disabled and the profiler panel is hidden.</p> <p>Use Cases:</p> <ul> <li>Temporarily disable during debugging sessions</li> <li>Environment-specific deactivation (e.g., in staging)</li> </ul> <p>Example:</p> <pre><code># config/packages/prod/doctrine_doctor.yaml\ndoctrine_doctor:\n    enabled: false  # Disable in production\n</code></pre>"},{"location":"CONFIGURATION/#4-analysis-configuration","title":"4. Analysis Configuration","text":""},{"location":"CONFIGURATION/#41-excluding-vendor-entities","title":"4.1 Excluding Vendor Entities","text":"<pre><code>doctrine_doctor:\n    analysis:\n        exclude_third_party_entities: true\n</code></pre> <p>Type: <code>boolean</code> Default: <code>true</code> Description: Automatically excludes entities from the <code>vendor/</code> directory during analysis. This filters out third-party entities from Symfony, Doctrine, FOSUserBundle, and other vendor bundles to provide cleaner, more relevant reports focused on your application code.</p> <p>How it works:</p> <ul> <li>Uses path-based detection (<code>/vendor/</code> in file path) - 100% reliable</li> <li>Filtering is completely transparent - no changes needed in your code</li> <li>Results are cached per request for optimal performance (~0.1ms overhead)</li> </ul> <p>Example: With this enabled (recommended), entities like <code>Symfony\\Component\\Security\\Core\\User\\User</code> or <code>FOS\\UserBundle\\Model\\User</code> will be excluded from analysis, while your <code>App\\Entity\\User</code> will be analyzed normally.</p> <p>When to disable: Only disable if you need to analyze vendor entity mappings or debug third-party bundle configurations.</p>"},{"location":"CONFIGURATION/#5-profiler-configuration","title":"5. Profiler Configuration","text":""},{"location":"CONFIGURATION/#51-profiler-visibility","title":"5.1 Profiler Visibility","text":"<pre><code>doctrine_doctor:\n    profiler:\n        show_in_toolbar: true\n</code></pre> <p>Type: <code>boolean</code> Default: <code>true</code> Description: Controls whether the \"Doctrine Doctor\" panel appears in the Symfony Profiler toolbar.</p>"},{"location":"CONFIGURATION/#52-debug-information","title":"5.2 Debug Information","text":"<pre><code>doctrine_doctor:\n    profiler:\n        show_debug_info: false\n</code></pre> <p>Type: <code>boolean</code> Default: <code>false</code> Description: Displays internal debugging information (analyzer execution times, memory usage, service instances). For development of Doctrine Doctor itself only.</p>"},{"location":"CONFIGURATION/#53-enabling-query-backtraces","title":"5.3 Enabling Query Backtraces","text":"<p>To see code location backtraces in Doctrine Doctor issues, enable Doctrine DBAL's backtrace collection:</p> <pre><code># config/packages/dev/doctrine.yaml\ndoctrine:\n    dbal:\n        profiling_collect_backtrace: true\n</code></pre> <p>Type: <code>boolean</code> Default: <code>false</code> Description: Enables collection of stack traces for SQL queries, allowing Doctrine Doctor to show exactly where in your code each issue originates.</p> <p>Note: This is a Doctrine DBAL setting, not a Doctrine Doctor configuration. Add it to your <code>doctrine.yaml</code> file. Recommended for development environments only (minimal performance overhead ~2-5%).</p>"},{"location":"CONFIGURATION/#6-analyzer-configuration","title":"6. Analyzer Configuration","text":""},{"location":"CONFIGURATION/#61-performance-analyzers","title":"6.1 Performance Analyzers","text":""},{"location":"CONFIGURATION/#n1-query-analyzer","title":"N+1 Query Analyzer","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        n_plus_one:\n            enabled: true\n            threshold: 5\n</code></pre> Parameter Type Default Description <code>enabled</code> boolean <code>true</code> Enable/disable analyzer <code>threshold</code> integer <code>5</code> Minimum duplicate query occurrences to trigger detection <p>Tuning Guide:</p> <ul> <li>Strict: <code>threshold: 2</code> - Catch even minor N+1 issues</li> <li>Balanced: <code>threshold: 5</code> - Default, good signal-to-noise ratio</li> <li>Permissive: <code>threshold: 10</code> - Only major N+1 problems</li> </ul>"},{"location":"CONFIGURATION/#slow-query-analyzer","title":"Slow Query Analyzer","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        slow_query:\n            enabled: true\n            threshold: 100\n</code></pre> Parameter Type Default Description <code>enabled</code> boolean <code>true</code> Enable/disable analyzer <code>threshold</code> integer <code>100</code> Execution time threshold in milliseconds <p>Tuning by Environment:</p> <pre><code># Local development (fast SSD)\nthreshold: 20\n\n# Shared development server\nthreshold: 50\n\n# Staging (production-like hardware)\nthreshold: 100\n</code></pre>"},{"location":"CONFIGURATION/#missing-index-analyzer","title":"Missing Index Analyzer","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        missing_index:\n            enabled: true\n            slow_query_threshold: 100\n            min_rows_scanned: 1000\n            explain_queries: true\n</code></pre> Parameter Type Default Description <code>enabled</code> boolean <code>true</code> Enable/disable analyzer <code>slow_query_threshold</code> integer <code>100</code> Minimum execution time (ms) to trigger EXPLAIN analysis <code>min_rows_scanned</code> integer <code>1000</code> Minimum rows scanned to recommend index <code>explain_queries</code> boolean <code>true</code> Execute EXPLAIN queries (requires database permissions) <p>Database Permission Requirements:</p> <pre><code>-- MySQL: Ensure user can execute EXPLAIN\nGRANT SELECT ON database.* TO 'app_user'@'localhost';\n\n-- PostgreSQL: EXPLAIN requires SELECT permission\n-- No additional permissions needed\n</code></pre> <p>Performance Considerations:</p> <ul> <li><code>explain_queries: false</code> - Disable if database user lacks permissions or for performance</li> <li>Higher <code>min_rows_scanned</code> reduces false positives on small tables</li> </ul>"},{"location":"CONFIGURATION/#hydration-analyzer","title":"Hydration Analyzer","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        hydration:\n            enabled: true\n            row_threshold: 99\n            critical_threshold: 999\n</code></pre> Parameter Type Default Description <code>enabled</code> boolean <code>true</code> Enable/disable analyzer <code>row_threshold</code> integer <code>99</code> Rows to trigger \"High\" severity <code>critical_threshold</code> integer <code>999</code> Rows to trigger \"Critical\" severity"},{"location":"CONFIGURATION/#flush-in-loop-analyzer","title":"Flush in Loop Analyzer","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        flush_in_loop:\n            enabled: true\n            flush_count_threshold: 5\n            time_window_ms: 1000\n</code></pre> Parameter Type Default Description <code>enabled</code> boolean <code>true</code> Enable/disable analyzer <code>flush_count_threshold</code> integer <code>5</code> Minimum flush calls to detect loop pattern <code>time_window_ms</code> integer <code>1000</code> Time window (ms) to group flush calls"},{"location":"CONFIGURATION/#eager-loading-analyzer","title":"Eager Loading Analyzer","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        eager_loading:\n            enabled: true\n            join_threshold: 5\n            critical_join_threshold: 10\n</code></pre> Parameter Type Default Description <code>enabled</code> boolean <code>true</code> Enable/disable analyzer <code>join_threshold</code> integer <code>5</code> Number of JOINs to trigger \"Medium\" severity <code>critical_join_threshold</code> integer <code>10</code> Number of JOINs to trigger \"Critical\" severity"},{"location":"CONFIGURATION/#lazy-loading-analyzer","title":"Lazy Loading Analyzer","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        lazy_loading:\n            enabled: true\n            threshold: 10\n</code></pre> Parameter Type Default Description <code>enabled</code> boolean <code>true</code> Enable/disable analyzer <code>threshold</code> integer <code>10</code> Minimum lazy load events to trigger detection"},{"location":"CONFIGURATION/#bulk-operation-analyzer","title":"Bulk Operation Analyzer","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        bulk_operation:\n            enabled: true\n            threshold: 100\n</code></pre> Parameter Type Default Description <code>enabled</code> boolean <code>true</code> Enable/disable analyzer <code>threshold</code> integer <code>100</code> Entity count to recommend DQL bulk operations <p>Recommendation:</p> <pre><code>// Below threshold: ORM is acceptable\nforeach ($entities as $entity) {\n    $em-&gt;remove($entity);\n}\n$em-&gt;flush();\n\n// Above threshold: Use DQL\n$qb-&gt;delete(Entity::class, 'e')\n   -&gt;where('e.status = :status')\n   -&gt;setParameter('status', 'inactive')\n   -&gt;getQuery()\n   -&gt;execute();\n</code></pre>"},{"location":"CONFIGURATION/#entity-manager-clear-analyzer","title":"Entity Manager Clear Analyzer","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        entity_manager_clear:\n            enabled: true\n            batch_size_threshold: 100\n</code></pre> Parameter Type Default Description <code>enabled</code> boolean <code>true</code> Enable/disable analyzer <code>batch_size_threshold</code> integer <code>100</code> Entity count to recommend <code>clear()</code> calls"},{"location":"CONFIGURATION/#join-optimization-analyzer","title":"Join Optimization Analyzer","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        join_optimization:\n            enabled: true\n            max_joins_recommended: 5\n            max_joins_critical: 10\n</code></pre> Parameter Type Default Description <code>enabled</code> boolean <code>true</code> Enable/disable analyzer <code>max_joins_recommended</code> integer <code>5</code> Recommended maximum JOINs <code>max_joins_critical</code> integer <code>10</code> Critical threshold"},{"location":"CONFIGURATION/#partial-object-analyzer","title":"Partial Object Analyzer","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        partial_object:\n            enabled: true\n            threshold: 5\n</code></pre> Parameter Type Default Description <code>enabled</code> boolean <code>true</code> Enable/disable analyzer <code>threshold</code> integer <code>5</code> Minimum fields loaded to suggest partial objects"},{"location":"CONFIGURATION/#find-all-analyzer","title":"Find All Analyzer","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        find_all:\n            enabled: true\n            threshold: 99\n</code></pre> Parameter Type Default Description <code>enabled</code> boolean <code>true</code> Enable/disable analyzer <code>threshold</code> integer <code>99</code> Row count to flag <code>findAll()</code> usage"},{"location":"CONFIGURATION/#get-reference-analyzer","title":"Get Reference Analyzer","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        get_reference:\n            enabled: true\n            threshold: 10\n</code></pre> Parameter Type Default Description <code>enabled</code> boolean <code>true</code> Enable/disable analyzer <code>threshold</code> integer <code>10</code> Minimum <code>find()</code> calls to recommend <code>getReference()</code>"},{"location":"CONFIGURATION/#52-security-analyzers","title":"5.2 Security Analyzers","text":"<p>All security analyzers use <code>enabled</code> parameter only (no thresholds):</p> <pre><code>doctrine_doctor:\n    analyzers:\n        dql_injection:\n            enabled: true\n        sql_injection:\n            enabled: true\n        sensitive_data_exposure:\n            enabled: true\n        insecure_random:\n            enabled: true\n</code></pre> <p>Security Best Practice: Keep all security analyzers enabled at all times.</p>"},{"location":"CONFIGURATION/#53-architectural-analyzers","title":"5.3 Architectural Analyzers","text":"<p>Architectural analyzers typically have no configurable parameters beyond <code>enabled</code>:</p> <pre><code>doctrine_doctor:\n    analyzers:\n        cascade_configuration:\n            enabled: true\n        cascade_all:\n            enabled: true\n        bidirectional_consistency:\n            enabled: true\n        orphan_removal_without_cascade_remove:\n            enabled: true\n        # ... (see full list in ANALYZERS.md)\n</code></pre>"},{"location":"CONFIGURATION/#54-data-integrity-analyzers","title":"5.4 Data Integrity Analyzers","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        decimal_precision:\n            enabled: true\n        float_for_money:\n            enabled: true\n        timezone:\n            enabled: true\n        charset:\n            enabled: true\n        collation:\n            enabled: true\n        strict_mode:\n            enabled: true\n</code></pre>"},{"location":"CONFIGURATION/#55-best-practices-analyzers","title":"5.5 Best Practices Analyzers","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        naming_convention:\n            enabled: true\n        collection_initialization:\n            enabled: true\n        primary_key_strategy:\n            enabled: true\n        innodb_engine:\n            enabled: true\n</code></pre>"},{"location":"CONFIGURATION/#7-performance-thresholds","title":"7. Performance Thresholds","text":""},{"location":"CONFIGURATION/#71-recommended-thresholds-by-environment","title":"7.1 Recommended Thresholds by Environment","text":""},{"location":"CONFIGURATION/#local-development","title":"Local Development","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        slow_query:\n            threshold: 10  # Fast local database\n        n_plus_one:\n            threshold: 2   # Strict detection\n        missing_index:\n            min_rows_scanned: 500  # Detect early\n</code></pre>"},{"location":"CONFIGURATION/#shared-development-server","title":"Shared Development Server","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        slow_query:\n            threshold: 50\n        n_plus_one:\n            threshold: 3\n        missing_index:\n            min_rows_scanned: 1000\n</code></pre>"},{"location":"CONFIGURATION/#staging-production-like","title":"Staging (Production-like)","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        slow_query:\n            threshold: 100\n        n_plus_one:\n            threshold: 5  # Reduce noise\n        missing_index:\n            min_rows_scanned: 5000  # Production-scale data\n</code></pre>"},{"location":"CONFIGURATION/#8-group-management","title":"8. Group Management","text":"<p>\u26a0\ufe0f Note: Group-based configuration (<code>groups:</code> node) is not yet implemented.</p> <p>To enable/disable specific analyzers, use individual analyzer configuration:</p> <pre><code>doctrine_doctor:\n    analyzers:\n        n_plus_one:\n            enabled: false  # Disable specific analyzer\n        slow_query:\n            enabled: true   # Keep enabled\n</code></pre> <p>This feature is planned for a future release to allow bulk enable/disable by category.</p>"},{"location":"CONFIGURATION/#9-environment-specific-configuration","title":"9. Environment-Specific Configuration","text":""},{"location":"CONFIGURATION/#91-development-configuration","title":"9.1 Development Configuration","text":"<pre><code># config/packages/dev/doctrine_doctor.yaml\ndoctrine_doctor:\n    enabled: true\n\n    profiler:\n        show_in_toolbar: true\n        show_debug_info: true  # Show analyzer performance metrics\n\n    analyzers:\n        n_plus_one:\n            threshold: 2  # Strict\n\n        slow_query:\n            threshold: 20  # Fast local DB\n\n        missing_index:\n            explain_queries: true\n</code></pre>"},{"location":"CONFIGURATION/#82-test-configuration","title":"8.2 Test Configuration","text":"<pre><code># config/packages/test/doctrine_doctor.yaml\ndoctrine_doctor:\n    enabled: false  # Disable to avoid test overhead\n</code></pre>"},{"location":"CONFIGURATION/#83-production-configuration","title":"8.3 Production Configuration","text":"<pre><code># config/packages/prod/doctrine_doctor.yaml\ndoctrine_doctor:\n    enabled: false  # MUST be disabled in production\n</code></pre> <p>Critical: Doctrine Doctor should NEVER run in production. The bundle is excluded from production via:</p> <ul> <li><code>composer require --dev</code></li> <li>Explicit <code>enabled: false</code> in prod configuration</li> </ul>"},{"location":"CONFIGURATION/#10-advanced-configuration","title":"10. Advanced Configuration","text":""},{"location":"CONFIGURATION/#101-custom-analyzer-registration","title":"10.1 Custom Analyzer Registration","text":"<pre><code># config/services.yaml\nservices:\n    App\\Analyzer\\CustomBusinessRuleAnalyzer:\n        arguments:\n            $threshold: 50\n            $templateRenderer: '@AhmedBhs\\DoctrineDoctor\\Template\\Renderer\\TemplateRendererInterface'\n        tags:\n            - { name: 'doctrine_doctor.analyzer' }\n</code></pre>"},{"location":"CONFIGURATION/#92-custom-template-renderer","title":"9.2 Custom Template Renderer","text":"<pre><code>services:\n    App\\Infrastructure\\MarkdownTemplateRenderer:\n        arguments:\n            $templateDirectory: '%kernel.project_dir%/templates/doctrine_doctor'\n\n    # Override default renderer\n    AhmedBhs\\DoctrineDoctor\\Template\\Renderer\\TemplateRendererInterface:\n        alias: App\\Infrastructure\\MarkdownTemplateRenderer\n</code></pre>"},{"location":"CONFIGURATION/#93-service-decoration","title":"9.3 Service Decoration","text":"<pre><code>services:\n    App\\Decorator\\EnhancedIssueFactory:\n        decorates: AhmedBhs\\DoctrineDoctor\\Factory\\IssueFactoryInterface\n        arguments:\n            $inner: '@.inner'\n            $logger: '@logger'\n</code></pre>"},{"location":"CONFIGURATION/#94-conditional-configuration-via-environment-variables","title":"9.4 Conditional Configuration via Environment Variables","text":"<pre><code># config/packages/doctrine_doctor.yaml\ndoctrine_doctor:\n    enabled: '%env(bool:DOCTRINE_DOCTOR_ENABLED)%'\n\n    analyzers:\n        slow_query:\n            threshold: '%env(int:SLOW_QUERY_THRESHOLD)%'\n</code></pre> <pre><code># .env.local\nDOCTRINE_DOCTOR_ENABLED=true\nSLOW_QUERY_THRESHOLD=30\n</code></pre>"},{"location":"CONFIGURATION/#configuration-validation","title":"Configuration Validation","text":""},{"location":"CONFIGURATION/#validate-configuration-syntax","title":"Validate Configuration Syntax","text":"<pre><code># Check YAML syntax\nphp bin/console lint:yaml config/packages/doctrine_doctor.yaml\n\n# Validate container configuration\nphp bin/console debug:config doctrine_doctor\n\n# Dump complete merged configuration\nphp bin/console debug:config doctrine_doctor --resolve-env\n</code></pre>"},{"location":"CONFIGURATION/#common-configuration-errors","title":"Common Configuration Errors","text":""},{"location":"CONFIGURATION/#1-invalid-threshold-type","title":"1. Invalid Threshold Type","text":"<pre><code># \ud83d\udce2 Wrong\ndoctrine_doctor:\n    analyzers:\n        slow_query:\n            threshold: \"50\"  # String instead of integer\n\n# Correct\ndoctrine_doctor:\n    analyzers:\n        slow_query:\n            threshold: 50\n</code></pre>"},{"location":"CONFIGURATION/#2-unknown-analyzer-name","title":"2. Unknown Analyzer Name","text":"<pre><code># \ud83d\udce2 Wrong (typo)\ndoctrine_doctor:\n    analyzers:\n        n_pluss_one:  # Typo\n            enabled: true\n\n# Correct\ndoctrine_doctor:\n    analyzers:\n        n_plus_one:\n            enabled: true\n</code></pre>"},{"location":"CONFIGURATION/#3-missing-required-parameters","title":"3. Missing Required Parameters","text":"<pre><code># \ud83d\udce2 Incomplete\ndoctrine_doctor:\n    analyzers:\n        missing_index:\n            enabled: true\n            # Missing: slow_query_threshold, min_rows_scanned\n\n# Complete\ndoctrine_doctor:\n    analyzers:\n        missing_index:\n            enabled: true\n            slow_query_threshold: 100\n            min_rows_scanned: 1000\n            explain_queries: true\n</code></pre>"},{"location":"CONFIGURATION/#configuration-examples","title":"Configuration Examples","text":""},{"location":"CONFIGURATION/#minimal-configuration-use-defaults","title":"Minimal Configuration (Use Defaults)","text":"<pre><code># config/packages/dev/doctrine_doctor.yaml\ndoctrine_doctor:\n    enabled: true\n</code></pre>"},{"location":"CONFIGURATION/#performance-focused-configuration","title":"Performance-Focused Configuration","text":"<pre><code>doctrine_doctor:\n    groups:\n        performance: true\n        security: false\n        integrity: false\n        configuration: false\n\n    analyzers:\n        n_plus_one:\n            threshold: 2\n\n        slow_query:\n            threshold: 25\n\n        missing_index:\n            slow_query_threshold: 50\n            min_rows_scanned: 500\n</code></pre>"},{"location":"CONFIGURATION/#security-focused-configuration","title":"Security-Focused Configuration","text":"<pre><code>doctrine_doctor:\n    # Enable only security analyzers individually\n    analyzers:\n        dql_injection:\n            enabled: true\n        sql_injection:\n            enabled: true\n        sensitive_data_exposure:\n            enabled: true\n        # Disable performance analyzers\n        n_plus_one:\n            enabled: false\n        slow_query:\n            enabled: false\n</code></pre>"},{"location":"CONFIGURATION/#full-customization","title":"Full Customization","text":"<pre><code>doctrine_doctor:\n    enabled: true\n\n    profiler:\n        show_in_toolbar: true\n        show_debug_info: false\n\n    analyzers:\n        n_plus_one:\n            enabled: true\n            threshold: 5\n\n        slow_query:\n            enabled: true\n            threshold: 100\n\n        missing_index:\n            enabled: true\n            slow_query_threshold: 50\n            min_rows_scanned: 1000\n            explain_queries: true\n\n        hydration:\n            enabled: true\n            row_threshold: 99\n            critical_threshold: 999\n\n        flush_in_loop:\n            enabled: true\n            flush_count_threshold: 5\n            time_window_ms: 1000\n\n        eager_loading:\n            enabled: true\n            join_threshold: 5\n            critical_join_threshold: 10\n\n        lazy_loading:\n            enabled: true\n            threshold: 10\n\n        bulk_operation:\n            enabled: true\n            threshold: 100\n\n        entity_manager_clear:\n            enabled: true\n            batch_size_threshold: 100\n\n        join_optimization:\n            enabled: true\n            max_joins_recommended: 5\n            max_joins_critical: 10\n\n        partial_object:\n            enabled: true\n            threshold: 5\n\n        find_all:\n            enabled: true\n            threshold: 99\n\n        get_reference:\n            enabled: true\n            threshold: 10\n\n        # Security (no thresholds)\n        dql_injection:\n            enabled: true\n        sql_injection:\n            enabled: true\n        sensitive_data_exposure:\n            enabled: true\n        insecure_random:\n            enabled: true\n\n        # Code Quality (no thresholds)\n        cascade_configuration:\n            enabled: true\n        cascade_all:\n            enabled: true\n        bidirectional_consistency:\n            enabled: true\n\n        # Configuration (no thresholds)\n        decimal_precision:\n            enabled: true\n        float_for_money:\n            enabled: true\n        timezone:\n            enabled: true\n        charset:\n            enabled: true\n\n        # Best Practices (no thresholds)\n        naming_convention:\n            enabled: true\n        collection_initialization:\n            enabled: true\n        primary_key_strategy:\n            enabled: true\n</code></pre>"},{"location":"CONFIGURATION/#references","title":"References","text":"<ul> <li>Symfony Configuration Reference</li> <li>Symfony Best Practices - Configuration</li> <li>Environment Variables</li> </ul> <p>\u2190 Back to Main Documentation | Analyzer Reference \u2192 | Architecture \u2192</p>"},{"location":"TEMPLATE_ANALYSIS/","title":"Technical Analysis: PHP vs Twig Template Processors","text":""},{"location":"TEMPLATE_ANALYSIS/#executive-summary","title":"Executive Summary","text":"<p>This document provides a comprehensive technical analysis comparing PHP and Twig template processors for suggestion generation in the Doctrine Doctor bundle. The analysis examines 75 existing PHP templates (8,218 lines of code) and evaluates the feasibility, costs, and benefits of migration to Twig.</p> <p>Recommendation: Retain PHP templates for suggestion generation. Migration to Twig would provide minimal benefits while introducing significant costs and architectural complexities.</p>"},{"location":"TEMPLATE_ANALYSIS/#table-of-contents","title":"Table of Contents","text":"<ul> <li>1. Current State Analysis</li> <li>2. Comparative Technical Analysis</li> <li>3. Migration Cost Assessment</li> <li>4. Risk Analysis</li> <li>5. Architectural Implications</li> <li>6. Final Recommendation</li> </ul>"},{"location":"TEMPLATE_ANALYSIS/#1-current-state-analysis","title":"1. Current State Analysis","text":""},{"location":"TEMPLATE_ANALYSIS/#11-template-distribution","title":"1.1 Template Distribution","text":"Template Type Count Lines of Code Purpose PHP Suggestion Templates 75 8,218 Code generation, fix suggestions Twig UI Templates 1 450+ Symfony Profiler panel rendering Total 76 ~8,700 -"},{"location":"TEMPLATE_ANALYSIS/#12-template-complexity-analysis","title":"1.2 Template Complexity Analysis","text":"<p>Examination of representative templates reveals:</p> <p>Example: <code>dql_injection.php</code> (69 lines)</p> <ul> <li>HTML structure with semantic CSS classes</li> <li>Dynamic context extraction: <code>['query' =&gt; $query, 'vulnerable_parameters' =&gt; $vulnerableParams, ...]</code></li> <li>Security functions: <code>$e = fn(string $str): string =&gt; htmlspecialchars($str, ENT_QUOTES, 'UTF-8')</code></li> <li>Emojis and SVG icons for visual communication</li> <li>Multiple conditional blocks</li> <li>External documentation links</li> </ul> <p>Example: <code>flush_in_loop.php</code> (125 lines)</p> <ul> <li>Complex performance calculations: <code>ceil($flushCount / 20)</code>, <code>round((1 - (ceil($flushCount / 20) / $flushCount)) * 100)</code></li> <li>Dynamic text generation based on metrics</li> <li>Multiple code examples (bad vs. good)</li> <li>Performance impact tables</li> <li>Conditional rendering based on data</li> </ul> <p>Example: <code>missing_index.php</code> (131 lines)</p> <ul> <li>SQL formatter integration: <code>formatSqlWithHighlight()</code></li> <li>Array manipulation: <code>implode(', ', array_map(...))</code></li> <li>Multiple solution approaches (SQL, Migration, Annotation)</li> <li>Complex string interpolation</li> </ul>"},{"location":"TEMPLATE_ANALYSIS/#13-template-feature-matrix","title":"1.3 Template Feature Matrix","text":"Feature Usage Frequency Complexity Dynamic calculations High (60%) Medium-High Conditional rendering Very High (95%) Low-Medium Array manipulation High (70%) Medium Helper functions High (85%) Medium HTML escaping Very High (100%) Low SQL formatting Medium (30%) High Multi-line string building Very High (100%) Low"},{"location":"TEMPLATE_ANALYSIS/#2-comparative-technical-analysis","title":"2. Comparative Technical Analysis","text":""},{"location":"TEMPLATE_ANALYSIS/#21-feature-comparison","title":"2.1 Feature Comparison","text":"Capability PHP Templates Twig Templates Winner Dynamic Calculations Full PHP power Limited (filters only) PHP Complex Logic Unlimited Intentionally restricted PHP Helper Functions Direct function calls Must create custom filters PHP Auto-escaping \ud83d\udce2 Manual (<code>htmlspecialchars</code>) Automatic Twig Syntax Clarity Mixed HTML/PHP Clean separation Twig IDE Support Full PHP support Limited in some IDEs PHP Debugging Standard PHP debugging Template-specific tools PHP Performance Direct execution Compilation overhead PHP Code Generation Excellent Not designed for this PHP Security Manual escaping required Auto-escape by default Twig"},{"location":"TEMPLATE_ANALYSIS/#22-architectural-fit-analysis","title":"2.2 Architectural Fit Analysis","text":""},{"location":"TEMPLATE_ANALYSIS/#php-templates-code-generation-use-case","title":"PHP Templates: Code Generation Use Case","text":"<p>The current templates generate code suggestions and documentation, not user-facing UI. This is fundamentally different from traditional template use cases.</p> <pre><code>// Example from flush_in_loop.php - Complex code generation\n&lt;pre&gt;&lt;code class=\"language-php\"&gt;//  GOOD: Batch flush every 20 items\n$batchSize = 20;\n$i = 0;\n\nforeach ($items as $item) {\n    $entity = new Entity();\n    $entity-&gt;setData($item);\n    $em-&gt;persist($entity);\n\n    if (($i % $batchSize) === 0) {\n        $em-&gt;flush();\n        $em-&gt;clear();\n    }\n    $i++;\n}\n\n// Result: Only &lt;?php echo ceil($flushCount / 20); ?&gt; flush() calls instead of &lt;?php echo $flushCount; ?&gt;\n&lt;/code&gt;&lt;/pre&gt;\n</code></pre> <p>Analysis: This is code generation, not view rendering. PHP excels at this because:</p> <ol> <li>Direct access to all PHP functions</li> <li>No compilation overhead</li> <li>Full control over output formatting</li> <li>Easy debugging with standard PHP tools</li> </ol>"},{"location":"TEMPLATE_ANALYSIS/#twig-templates-ui-rendering-use-case","title":"Twig Templates: UI Rendering Use Case","text":"<p>Twig is designed for separating logic from presentation in user-facing interfaces.</p> <pre><code>{# From doctrine_doctor.html.twig - UI rendering #}\n&lt;div class=\"issue-card\"&gt;\n    &lt;div class=\"issue-header {{ issue.getSeverity().value == 'critical' ? 'severity-critical' : 'severity-warning' }}\"&gt;\n        &lt;span class=\"issue-badge\"&gt;{{ issue.getType() }}&lt;/span&gt;\n        &lt;h3&gt;{{ issue.getTitle() }}&lt;/h3&gt;\n    &lt;/div&gt;\n&lt;/div&gt;\n</code></pre> <p>Analysis: Perfect for Symfony Profiler UI because:</p> <ol> <li>Separation of concerns (data vs. presentation)</li> <li>Auto-escaping prevents XSS</li> <li>Integration with Symfony ecosystem</li> <li>Template inheritance and macros</li> </ol>"},{"location":"TEMPLATE_ANALYSIS/#23-performance-comparison","title":"2.3 Performance Comparison","text":"<p>PHP Template Rendering:</p> <pre><code>1. File include: ~0.1ms\n2. Execute PHP: ~0.5ms\n3. Return array: ~0.01ms\nTotal: ~0.6ms per template\n</code></pre> <p>Twig Template Rendering:</p> <pre><code>1. Load template: ~0.2ms\n2. Compile (if not cached): ~5-10ms\n3. Execute compiled PHP: ~0.8ms\n4. Return output: ~0.01ms\nTotal (cached): ~1.0ms per template\nTotal (uncached): ~11ms per template\n</code></pre> <p>Verdict: PHP templates are 40-60% faster for this use case because:</p> <ul> <li>No compilation step</li> <li>Direct execution</li> <li>Simpler rendering pipeline</li> </ul>"},{"location":"TEMPLATE_ANALYSIS/#3-migration-cost-assessment","title":"3. Migration Cost Assessment","text":""},{"location":"TEMPLATE_ANALYSIS/#31-development-cost","title":"3.1 Development Cost","text":"<p>Estimated effort to migrate 75 templates:</p> Task Estimated Hours Notes Create custom Twig filters 40h <code>formatSql</code>, <code>escape</code>, <code>calculatePerformance</code>, etc. Migrate templates (75 \u00d7 2h) 150h Rewrite logic as filters, test each Update renderer infrastructure 16h Modify DI, configuration Update tests 24h 75 templates \u00d7 ~20 min each Documentation updates 8h Architecture docs, developer guide Total 238 hours ~6 weeks for 1 developer <p>Cost: \u20ac15,000 - \u20ac25,000 (assuming \u20ac60-100/hour)</p>"},{"location":"TEMPLATE_ANALYSIS/#32-maintenance-cost","title":"3.2 Maintenance Cost","text":"<p>Current (PHP templates):</p> <ul> <li>Adding new template: 1-2 hours</li> <li>Modifying existing: 30 min - 1 hour</li> <li>Debugging: Standard PHP debugging tools</li> <li>No compilation concerns</li> </ul> <p>After Twig migration:</p> <ul> <li>Adding new template: 2-3 hours (must implement filters first)</li> <li>Modifying existing: 1-2 hours (may need new filters)</li> <li>Debugging: Twig-specific debugging, less intuitive</li> <li>Cache clearing overhead</li> </ul> <p>Verdict: Maintenance cost increases by 50-100%</p>"},{"location":"TEMPLATE_ANALYSIS/#33-technical-debt","title":"3.3 Technical Debt","text":"<p>Migration introduces new technical debt:</p> <ol> <li>Custom Filters: 20+ custom Twig filters to maintain</li> <li>Dual Template System: Still need PHP for complex logic</li> <li>Performance Overhead: Compilation layer adds complexity</li> <li>Learning Curve: Contributors must learn Twig syntax</li> <li>Testing Complexity: Must test both filters and templates</li> </ol>"},{"location":"TEMPLATE_ANALYSIS/#4-risk-analysis","title":"4. Risk Analysis","text":""},{"location":"TEMPLATE_ANALYSIS/#41-migration-risks","title":"4.1 Migration Risks","text":"Risk Probability Impact Mitigation Breaking changes during migration High High Comprehensive test suite Performance regression Medium Medium Benchmarking before/after Incomplete feature parity High High Detailed feature mapping Contributor resistance Medium Medium Training, documentation Maintenance burden increase High High None (inherent to Twig)"},{"location":"TEMPLATE_ANALYSIS/#42-current-system-risks","title":"4.2 Current System Risks","text":"Risk Probability Impact Mitigation XSS via missing escaping Low Medium Code review, linting Template inconsistency Low Low Template guidelines Performance issues Very Low Low Already optimized <p>Verdict: Migration introduces significantly more risk than it mitigates.</p>"},{"location":"TEMPLATE_ANALYSIS/#5-architectural-implications","title":"5. Architectural Implications","text":""},{"location":"TEMPLATE_ANALYSIS/#51-current-architecture-dual-purpose-design","title":"5.1 Current Architecture: Dual-Purpose Design","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Template Processors                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                              \u2502\n\u2502  Twig Templates                              \u2502\n\u2502  \u2514\u2500 Purpose: UI Rendering (Profiler)        \u2502\n\u2502  \u2514\u2500 Strengths: Auto-escape, inheritance     \u2502\n\u2502  \u2514\u2500 Use case: User-facing interface         \u2502\n\u2502                                              \u2502\n\u2502  PHP Templates                               \u2502\n\u2502  \u2514\u2500 Purpose: Code Generation (Suggestions)  \u2502\n\u2502  \u2514\u2500 Strengths: Full PHP power, performance  \u2502\n\u2502  \u2514\u2500 Use case: Developer documentation       \u2502\n\u2502                                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>This is a deliberate architectural decision, not an oversight.</p>"},{"location":"TEMPLATE_ANALYSIS/#52-separation-of-concerns-analysis","title":"5.2 Separation of Concerns Analysis","text":"<p>Current design follows the principle:</p> <p>\"Use the right tool for the job\"</p> <ul> <li>Twig for UI: Separates presentation from logic (MVC pattern)</li> <li>PHP for code generation: Direct access to language features</li> </ul> <p>Alternative (single template system):</p> <ul> <li>Forces compromise in both use cases</li> <li>Either limits code generation (Twig) or mixes logic with presentation (PHP everywhere)</li> </ul>"},{"location":"TEMPLATE_ANALYSIS/#53-framework-agnostic-consideration","title":"5.3 Framework-Agnostic Consideration","text":"<p>From ROADMAP.md, there is a future goal to support multiple frameworks.</p> <p>PHP Templates advantage:</p> <ul> <li>Zero external dependencies (no Twig requirement)</li> <li>Works in any PHP environment</li> <li>Easier to extract into standalone library</li> </ul> <p>Twig Templates disadvantage:</p> <ul> <li>Requires Twig dependency (~500KB)</li> <li>Framework-specific integration</li> <li>Harder to make framework-agnostic</li> </ul>"},{"location":"TEMPLATE_ANALYSIS/#6-final-recommendation","title":"6. Final Recommendation","text":""},{"location":"TEMPLATE_ANALYSIS/#61-recommendation-retain-php-templates","title":"6.1 Recommendation: RETAIN PHP TEMPLATES","text":"<p>Rationale:</p> <ol> <li>Architectural Fit: PHP templates are the correct tool for code generation</li> <li>Cost-Benefit: Migration cost (\u20ac15-25K, 6 weeks) provides zero functional benefit</li> <li>Performance: PHP templates are 40-60% faster</li> <li>Maintainability: Current system is simpler, easier to maintain</li> <li>Future-Proof: Better for framework-agnostic goals</li> </ol>"},{"location":"TEMPLATE_ANALYSIS/#62-improvements-to-current-system","title":"6.2 Improvements to Current System","text":"<p>Instead of migration, recommend these enhancements:</p>"},{"location":"TEMPLATE_ANALYSIS/#621-enhanced-security","title":"6.2.1 Enhanced Security","text":"<pre><code>// src/Template/helpers.php - Improved escaping\nfunction e(string $str, string $context = 'html'): string\n{\n    return match($context) {\n        'html' =&gt; htmlspecialchars($str, ENT_QUOTES, 'UTF-8'),\n        'attr' =&gt; htmlspecialchars($str, ENT_QUOTES | ENT_HTML5, 'UTF-8'),\n        'js'   =&gt; json_encode($str, JSON_HEX_TAG | JSON_HEX_AMP),\n        'css'  =&gt; preg_replace('/[^a-zA-Z0-9\\-_]/', '', $str),\n        default =&gt; htmlspecialchars($str, ENT_QUOTES, 'UTF-8'),\n    };\n}\n</code></pre>"},{"location":"TEMPLATE_ANALYSIS/#622-template-validation","title":"6.2.2 Template Validation","text":"<pre><code>// src/Template/Validator/TemplateValidator.php\nfinal class TemplateValidator\n{\n    /**\n     * Validates that all context variables are escaped.\n     */\n    public function validate(string $templatePath): ValidationResult\n    {\n        $content = file_get_contents($templatePath);\n\n        // Check for unescaped variables\n        preg_match_all('/\\$\\w+/', $content, $matches);\n\n        foreach ($matches[0] as $var) {\n            if (!preg_match('/htmlspecialchars|escape|e\\(/', $content)) {\n                // Warning: potential XSS\n            }\n        }\n\n        return $result;\n    }\n}\n</code></pre>"},{"location":"TEMPLATE_ANALYSIS/#623-template-linting","title":"6.2.3 Template Linting","text":"<pre><code># .php-cs-fixer.dist.php - Add template-specific rules\n&lt;?php\n\nreturn (new PhpCsFixer\\Config())\n    -&gt;setRules([\n        '@PSR12' =&gt; true,\n        'no_mixed_echo_print' =&gt; ['use' =&gt; 'echo'],\n        // Enforce escaping in templates\n        'escape_implicit_backslashes' =&gt; true,\n    ])\n    -&gt;setFinder(\n        PhpCsFixer\\Finder::create()\n            -&gt;in(__DIR__ . '/src/Template/Suggestions')\n    );\n</code></pre>"},{"location":"TEMPLATE_ANALYSIS/#624-documentation","title":"6.2.4 Documentation","text":"<p>Create <code>docs/TEMPLATE_GUIDELINES.md</code>:</p> <pre><code>## PHP Template Security Guidelines\n\n1. **Always escape output**: Use `$e()` helper for all variables\n2. **Validate context**: Ensure all required variables exist\n3. **Return structure**: Must return `['code' =&gt; string, 'description' =&gt; string]`\n4. **No side effects**: Templates must be pure (no DB access, no file writes)\n5. **Testing**: Each template must have unit test\n</code></pre>"},{"location":"TEMPLATE_ANALYSIS/#63-cost-comparison","title":"6.3 Cost Comparison","text":"Approach Cost Timeline Risk Migrate to Twig \u20ac15,000-25,000 6 weeks High Improve PHP templates \u20ac3,000-5,000 1-2 weeks Low <p>Savings: \u20ac10,000-20,000 + reduced maintenance burden</p>"},{"location":"TEMPLATE_ANALYSIS/#64-decision-matrix","title":"6.4 Decision Matrix","text":"Criterion Weight PHP Templates Twig Templates Architectural fit 25% 10/10 5/10 Performance 20% 9/10 6/10 Development cost 15% 10/10 3/10 Maintenance cost 15% 8/10 5/10 Security 15% 7/10 9/10 Framework-agnostic 10% 10/10 4/10 ****Total** 100% 8.95/10 5.45/10 <p>Winner: PHP Templates (8.95 vs 5.45)</p>"},{"location":"TEMPLATE_ANALYSIS/#7-conclusion","title":"7. Conclusion","text":"<p>The current dual-template architecture is intentional and optimal:</p> <ul> <li>Twig for UI rendering (Symfony Profiler panel) - correct use of MVC separation</li> <li>PHP for code generation (suggestions, documentation) - correct use of native language features</li> </ul> <p>Migration to Twig would:</p> <ul> <li>\ud83d\udce2 Cost \u20ac15,000-25,000</li> <li>\ud83d\udce2 Take 6 weeks</li> <li>\ud83d\udce2 Reduce performance by 40-60%</li> <li>\ud83d\udce2 Increase maintenance complexity</li> <li>\ud83d\udce2 Introduce new risks</li> <li>\ud83d\udce2 Provide zero functional benefits</li> </ul> <p>Recommended action:</p> <ol> <li>Retain PHP templates for suggestions</li> <li>Enhance security with improved helpers (\u20ac3K investment)</li> <li>Add template validation and linting (\u20ac2K investment)</li> <li>Document best practices (\u20ac500 investment)</li> <li>Focus resources on new analyzers and features</li> </ol> <p>Total savings: \u20ac10,000-20,000 + ongoing maintenance savings</p>"},{"location":"TEMPLATE_ANALYSIS/#references","title":"References","text":"<ol> <li>Twig Documentation: https://twig.symfony.com/doc/</li> <li>PHP Template Security Best Practices: https://www.php.net/manual/en/security.php</li> <li>Symfony Best Practices: https://symfony.com/doc/current/best_practices.html</li> <li>OWASP XSS Prevention: https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html</li> </ol> <p>\u2190 Back to Main Documentation | Architecture Documentation \u2192</p>"},{"location":"TEMPLATE_SECURITY/","title":"PHP Template Security Guide","text":""},{"location":"TEMPLATE_SECURITY/#overview","title":"Overview","text":"<p>This document describes the security features implemented in the PHP template rendering system to prevent XSS (Cross-Site Scripting) and other injection attacks.</p>"},{"location":"TEMPLATE_SECURITY/#table-of-contents","title":"Table of Contents","text":"<ul> <li>1. Auto-Escaping with SafeContext</li> <li>2. Context-Aware Escaping</li> <li>3. Security Best Practices</li> <li>4. Migration Guide</li> <li>5. Common Pitfalls</li> </ul>"},{"location":"TEMPLATE_SECURITY/#1-auto-escaping-with-safecontext","title":"1. Auto-Escaping with SafeContext","text":""},{"location":"TEMPLATE_SECURITY/#11-overview","title":"1.1 Overview","text":"<p>The <code>SafeContext</code> class provides automatic HTML escaping for all template variables, similar to Twig's auto-escaping feature.</p> <p>Security Benefits:</p> <ul> <li>Prevents XSS by default</li> <li>Immutable context prevents variable tampering</li> <li>Type-safe access to variables</li> <li>Clear separation between safe and unsafe content</li> </ul>"},{"location":"TEMPLATE_SECURITY/#12-usage-in-templates","title":"1.2 Usage in Templates","text":"<p>Basic Usage (Auto-Escaped):</p> <pre><code>// Template context:\n// ['username' =&gt; '&lt;script&gt;alert(\"XSS\")&lt;/script&gt;']\n\n// SAFE - Auto-escaped\necho $context-&gt;username;\n// Output: &amp;lt;script&amp;gt;alert(&amp;quot;XSS&amp;quot;)&amp;lt;/script&amp;gt;\n\n// SAFE - Array access also auto-escapes\necho $context['username'];\n// Output: &amp;lt;script&amp;gt;alert(&amp;quot;XSS&amp;quot;)&amp;lt;/script&amp;gt;\n</code></pre> <p>Raw Output (Intentional Unescaped):</p> <pre><code>// UNSAFE - Use only for pre-sanitized content\necho $context-&gt;raw('formatted_sql');\n\n// Example: SQL syntax highlighting is already sanitized\necho $context-&gt;raw('highlighted_code');\n</code></pre> <p>Conditional Checks:</p> <pre><code>// Check if variable exists\nif ($context-&gt;has('suggestion')) {\n    echo $context-&gt;suggestion;\n}\n\n// Get all available keys\n$keys = $context-&gt;keys();\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#13-array-handling","title":"1.3 Array Handling","text":"<p>Arrays are recursively escaped:</p> <pre><code>// Context: ['items' =&gt; ['&lt;script&gt;', 'safe', '&lt;img&gt;']]\n\nforeach ($context-&gt;items as $item) {\n    echo $item; // Each item is auto-escaped\n}\n\n// Output:\n// &amp;lt;script&amp;gt;\n// safe\n// &amp;lt;img&amp;gt;\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#14-type-preservation","title":"1.4 Type Preservation","text":"<p>Non-string types are preserved:</p> <pre><code>// Context:\n// [\n//     'count' =&gt; 42,\n//     'price' =&gt; 19.99,\n//     'active' =&gt; true,\n//     'data' =&gt; null,\n// ]\n\necho $context-&gt;count;  // 42 (int)\necho $context-&gt;price;  // 19.99 (float)\necho $context-&gt;active; // true (bool)\necho $context-&gt;data;   // null\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#2-context-aware-escaping","title":"2. Context-Aware Escaping","text":"<p>For advanced use cases, the <code>escapeContext()</code> helper provides context-specific escaping.</p>"},{"location":"TEMPLATE_SECURITY/#21-available-contexts","title":"2.1 Available Contexts","text":"Context Use Case Example <code>html</code> HTML content (default) <code>&lt;div&gt;&lt;?php echo escapeContext($text, 'html'); ?&gt;&lt;/div&gt;</code> <code>attr</code> HTML attributes <code>&lt;div class=\"&lt;?php echo escapeContext($class, 'attr'); ?&gt;\"&gt;</code> <code>js</code> JavaScript strings <code>var name = &lt;?php echo escapeContext($name, 'js'); ?&gt;;</code> <code>css</code> CSS identifiers <code>.&lt;?php echo escapeContext($class, 'css'); ?&gt; { }</code> <code>url</code> URL parameters <code>?param=&lt;?php echo escapeContext($value, 'url'); ?&gt;</code>"},{"location":"TEMPLATE_SECURITY/#22-examples","title":"2.2 Examples","text":"<p>HTML Context (Default):</p> <pre><code>&lt;p&gt;&lt;?php echo escapeContext($userInput, 'html'); ?&gt;&lt;/p&gt;\n</code></pre> <p>Attribute Context:</p> <pre><code>&lt;div class=\"user-&lt;?php echo escapeContext($userId, 'attr'); ?&gt;\"&gt;\n    &lt;a href=\"/profile/&lt;?php echo escapeContext($username, 'url'); ?&gt;\"&gt;\n        Profile\n    &lt;/a&gt;\n&lt;/div&gt;\n</code></pre> <p>JavaScript Context:</p> <pre><code>&lt;script&gt;\n    var config = {\n        username: &lt;?php echo escapeContext($username, 'js'); ?&gt;,\n        message: &lt;?php echo escapeContext($message, 'js'); ?&gt;\n    };\n&lt;/script&gt;\n</code></pre> <p>CSS Context:</p> <pre><code>&lt;style&gt;\n    .severity-&lt;?php echo escapeContext($severity, 'css'); ?&gt; {\n        color: red;\n    }\n&lt;/style&gt;\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#3-security-best-practices","title":"3. Security Best Practices","text":""},{"location":"TEMPLATE_SECURITY/#31-default-rule-use-safecontext","title":"3.1 Default Rule: Use SafeContext","text":"<p>GOOD:</p> <pre><code>// Auto-escaped by default\n&lt;h3&gt;&lt;?php echo $context-&gt;title; ?&gt;&lt;/h3&gt;\n&lt;p&gt;&lt;?php echo $context-&gt;description; ?&gt;&lt;/p&gt;\n</code></pre> <p>\ud83d\udce2 BAD:</p> <pre><code>// Manual extraction bypasses auto-escaping\nextract($context);\n&lt;h3&gt;&lt;?php echo $title; ?&gt;&lt;/h3&gt; &lt;!-- NOT ESCAPED! --&gt;\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#32-when-to-use-raw","title":"3.2 When to Use raw()","text":"<p>Only use <code>raw()</code> for:</p> <ol> <li>Pre-sanitized HTML (e.g., SQL syntax highlighting from Doctrine)</li> <li>Trusted content (e.g., generated code examples)</li> <li>Already-escaped content (avoid double-escaping)</li> </ol> <p>GOOD - Pre-sanitized:</p> <pre><code>// formatSqlWithHighlight() already escapes and adds HTML\n&lt;div class=\"query-item\"&gt;\n    &lt;?php echo $context-&gt;raw('formatted_sql'); ?&gt;\n&lt;/div&gt;\n</code></pre> <p>\ud83d\udce2 BAD - User input:</p> <pre><code>// NEVER use raw() on user input\n&lt;div&gt;\n    &lt;?php echo $context-&gt;raw('user_comment'); ?&gt; &lt;!-- XSS VULNERABILITY! --&gt;\n&lt;/div&gt;\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#33-backward-compatibility","title":"3.3 Backward Compatibility","text":"<p>For existing templates using <code>extract()</code>, variables are still available but NOT auto-escaped:</p> <pre><code>// Old style (still works but NOT auto-escaped)\nextract($context);\necho htmlspecialchars($username, ENT_QUOTES, 'UTF-8'); // Manual escape required\n\n// New style (auto-escaped)\necho $context-&gt;username; // Safe by default\n</code></pre> <p>Migration Recommendation: Update templates to use <code>$context-&gt;</code> for new code.</p>"},{"location":"TEMPLATE_SECURITY/#4-migration-guide","title":"4. Migration Guide","text":""},{"location":"TEMPLATE_SECURITY/#41-updating-existing-templates","title":"4.1 Updating Existing Templates","text":"<p>Before:</p> <pre><code>&lt;?php\n// Old template using extract()\nextract($context);\n$e = fn(string $str): string =&gt; htmlspecialchars($str, ENT_QUOTES, 'UTF-8');\n?&gt;\n\n&lt;div class=\"alert\"&gt;\n    &lt;strong&gt;&lt;?php echo $e($title); ?&gt;&lt;/strong&gt;\n    &lt;p&gt;&lt;?php echo $e($message); ?&gt;&lt;/p&gt;\n&lt;/div&gt;\n</code></pre> <p>After:</p> <pre><code>&lt;?php\n// New template using SafeContext\n// No need for manual escaping function\n?&gt;\n\n&lt;div class=\"alert\"&gt;\n    &lt;strong&gt;&lt;?php echo $context-&gt;title; ?&gt;&lt;/strong&gt;\n    &lt;p&gt;&lt;?php echo $context-&gt;message; ?&gt;&lt;/p&gt;\n&lt;/div&gt;\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#42-migration-checklist","title":"4.2 Migration Checklist","text":"<ul> <li> Replace <code>$e($variable)</code> with <code>$context-&gt;variable</code></li> <li> Remove manual <code>htmlspecialchars()</code> calls</li> <li> Use <code>$context-&gt;raw()</code> for pre-sanitized content</li> <li> Add tests for XSS prevention</li> <li> Review all <code>raw()</code> usage with security team</li> </ul>"},{"location":"TEMPLATE_SECURITY/#43-gradual-migration","title":"4.3 Gradual Migration","text":"<p>Templates can use both styles during migration:</p> <pre><code>// Safe: Both work together\necho $context-&gt;username;      // Auto-escaped\necho htmlspecialchars($oldVar, ENT_QUOTES, 'UTF-8'); // Manual escape\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#5-common-pitfalls","title":"5. Common Pitfalls","text":""},{"location":"TEMPLATE_SECURITY/#51-double-escaping","title":"5.1 Double-Escaping","text":"<p>Problem:</p> <pre><code>// \ud83d\udce2 BAD - Double-escaped\necho htmlspecialchars($context-&gt;username, ENT_QUOTES, 'UTF-8');\n// Output: &amp;amp;lt;script&amp;amp;gt; (double-encoded)\n</code></pre> <p>Solution:</p> <pre><code>// GOOD - Use raw() to get unescaped value, then escape once\necho htmlspecialchars($context-&gt;raw('username'), ENT_QUOTES, 'UTF-8');\n\n// BETTER - Just use auto-escaping\necho $context-&gt;username;\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#52-forgetting-to-escape-in-attributes","title":"5.2 Forgetting to Escape in Attributes","text":"<p>Problem:</p> <pre><code>// \ud83d\udce2 VULNERABLE - Attribute injection\n&lt;div class=\"user-&lt;?php echo $context-&gt;raw('userId'); ?&gt;\"&gt;\n</code></pre> <p>Solution:</p> <pre><code>// SAFE - Auto-escaped\n&lt;div class=\"user-&lt;?php echo $context-&gt;userId; ?&gt;\"&gt;\n\n// SAFE - Context-aware escaping\n&lt;div class=\"user-&lt;?php echo escapeContext($context-&gt;raw('userId'), 'attr'); ?&gt;\"&gt;\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#53-javascript-context-errors","title":"5.3 JavaScript Context Errors","text":"<p>Problem:</p> <pre><code>// \ud83d\udce2 WRONG - HTML escaping in JavaScript breaks syntax\n&lt;script&gt;\n    var name = \"&lt;?php echo $context-&gt;name; ?&gt;\";\n    // Output: var name = \"&amp;lt;script&amp;gt;\"; (breaks JS)\n&lt;/script&gt;\n</code></pre> <p>Solution:</p> <pre><code>// CORRECT - Use JS context escaping\n&lt;script&gt;\n    var name = &lt;?php echo escapeContext($context-&gt;raw('name'), 'js'); ?&gt;;\n    // Output: var name = \"\\u003Cscript\\u003E\"; (safe and valid JS)\n&lt;/script&gt;\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#54-trusting-safe-user-input","title":"5.4 Trusting \"Safe\" User Input","text":"<p>Problem:</p> <pre><code>// \ud83d\udce2 DANGEROUS ASSUMPTION\n// \"Admin users are trusted, so we can use raw()\"\nif ($user-&gt;isAdmin()) {\n    echo $context-&gt;raw('comment'); // STILL VULNERABLE!\n}\n</code></pre> <p>Solution:</p> <pre><code>// PRINCIPLE: Never trust ANY user input\necho $context-&gt;comment; // Always escape, regardless of user role\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#xss-prevention-examples","title":"XSS Prevention Examples","text":""},{"location":"TEMPLATE_SECURITY/#example-1-preventing-script-injection","title":"Example 1: Preventing Script Injection","text":"<p>Attack:</p> <pre><code>Input: &lt;script&gt;alert('XSS')&lt;/script&gt;\n</code></pre> <p>Defense:</p> <pre><code>echo $context-&gt;input;\n// Output: &amp;lt;script&amp;gt;alert(&amp;#039;XSS&amp;#039;)&amp;lt;/script&amp;gt;\n// Browser displays: &lt;script&gt;alert('XSS')&lt;/script&gt; (as text, not executed)\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#example-2-preventing-attribute-injection","title":"Example 2: Preventing Attribute Injection","text":"<p>Attack:</p> <pre><code>Input: \" onclick=\"alert('XSS')\n</code></pre> <p>Defense:</p> <pre><code>&lt;button class=\"&lt;?php echo $context-&gt;input; ?&gt;\"&gt;Click&lt;/button&gt;\n// Output: &lt;button class=\"&amp;quot; onclick=&amp;quot;alert(&amp;#039;XSS&amp;#039;)\"&gt;Click&lt;/button&gt;\n// Quote is escaped, attribute injection prevented\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#example-3-preventing-url-injection","title":"Example 3: Preventing URL Injection","text":"<p>Attack:</p> <pre><code>Input: javascript:alert('XSS')\n</code></pre> <p>Defense:</p> <pre><code>&lt;a href=\"&lt;?php echo escapeContext($context-&gt;raw('url'), 'url'); ?&gt;\"&gt;Link&lt;/a&gt;\n// Output: &lt;a href=\"javascript%3Aalert%28%27XSS%27%29\"&gt;Link&lt;/a&gt;\n// URL is encoded, script execution prevented\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#testing-security","title":"Testing Security","text":""},{"location":"TEMPLATE_SECURITY/#unit-tests","title":"Unit Tests","text":"<p>All security features are covered by unit tests in <code>tests/Unit/Template/Security/SafeContextTest.php</code>.</p> <p>Run security tests:</p> <pre><code>vendor/bin/phpunit --testsuite unit --filter SafeContext\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#manual-testing","title":"Manual Testing","text":"<p>Test XSS Prevention:</p> <pre><code>// Create test context with XSS payloads\n$context = new SafeContext([\n    'test1' =&gt; '&lt;script&gt;alert(1)&lt;/script&gt;',\n    'test2' =&gt; '&lt;img src=x onerror=alert(1)&gt;',\n    'test3' =&gt; 'javascript:alert(1)',\n]);\n\n// Verify all are escaped\nvar_dump($context-&gt;test1); // Should NOT contain executable script\nvar_dump($context-&gt;test2); // Should NOT contain onerror handler\nvar_dump($context-&gt;test3); // Should NOT contain javascript: protocol\n</code></pre>"},{"location":"TEMPLATE_SECURITY/#references","title":"References","text":"<ul> <li>OWASP XSS Prevention Cheat Sheet</li> <li>PHP htmlspecialchars() Documentation</li> <li>Twig Auto-Escaping Strategy</li> <li>Content Security Policy (CSP)</li> </ul> <p>\u2190 Back to Main Documentation | Template Analysis \u2192</p>"},{"location":"about/changelog/","title":"Changelog","text":"<p>All notable changes to Doctrine Doctor will be documented in this file.</p> <p>The format is based on Keep a Changelog, and this project adheres to Semantic Versioning.</p>"},{"location":"about/changelog/#unreleased","title":"[Unreleased]","text":""},{"location":"about/changelog/#added","title":"Added","text":"<ul> <li>Documentation website with MkDocs Material</li> <li>Comprehensive examples for N+1 queries, missing indexes, and security issues</li> <li>Development guide for contributors</li> </ul>"},{"location":"about/changelog/#100-2024-xx-xx","title":"[1.0.0] - 2024-XX-XX","text":""},{"location":"about/changelog/#added_1","title":"Added","text":"<ul> <li>Initial release of Doctrine Doctor</li> <li>66 specialized analyzers across 4 categories:</li> <li>Performance (25 analyzers)</li> <li>Security (8 analyzers)</li> <li>Code Quality (20 analyzers)</li> <li>Configuration (13 analyzers)</li> <li>Symfony Web Profiler integration</li> <li>Configurable thresholds and analyzer settings</li> <li>Template rendering system for suggestions</li> <li>Query backtrace support</li> <li>Issue deduplication</li> <li>Real-time analysis with LateDataCollector</li> </ul>"},{"location":"about/changelog/#performance-analyzers","title":"Performance Analyzers","text":"<ul> <li>N+1 Query Detection</li> <li>Missing Index Detection</li> <li>Slow Query Detection</li> <li>Hydration Analysis</li> <li>Flush in Loop Detection</li> <li>And 20 more...</li> </ul>"},{"location":"about/changelog/#security-analyzers","title":"Security Analyzers","text":"<ul> <li>DQL Injection Detection</li> <li>SQL Injection Detection</li> <li>Sensitive Data Exposure</li> <li>Insecure Random Number Generation</li> <li>And 4 more...</li> </ul>"},{"location":"about/changelog/#code-quality-analyzers","title":"Code Quality Analyzers","text":"<ul> <li>Cascade Configuration Issues</li> <li>Bidirectional Relationship Consistency</li> <li>Orphan Removal Issues</li> <li>Type Mismatches</li> <li>And 16 more...</li> </ul>"},{"location":"about/changelog/#configuration-analyzers","title":"Configuration Analyzers","text":"<ul> <li>Charset/Collation Validation</li> <li>Timezone Configuration</li> <li>MySQL Strict Mode</li> <li>InnoDB Engine Checks</li> <li>And 9 more...</li> </ul>"},{"location":"about/changelog/#version-history","title":"Version History","text":"<p>For complete version history and detailed changelogs, see:</p> <ul> <li>GitHub Releases</li> <li>Packagist</li> </ul>"},{"location":"about/changelog/#upgrade-guides","title":"Upgrade Guides","text":""},{"location":"about/changelog/#upgrading-to-200-future","title":"Upgrading to 2.0.0 (Future)","text":"<p>When version 2.0.0 is released, upgrade instructions will be provided here.</p>"},{"location":"about/changelog/#contributing","title":"Contributing","text":"<p>Found a bug or have a feature request? Please check:</p> <ol> <li>Existing Issues</li> <li>Contributing Guide</li> <li>Development Setup</li> </ol> <p>\u2190 License | Home \u2192</p>"},{"location":"about/license/","title":"License","text":"<p>Doctrine Doctor is released under the MIT License.</p>"},{"location":"about/license/#mit-license","title":"MIT License","text":"<pre><code>MIT License\n\nCopyright (c) 2024-2026 Ahmed EBEN HASSINE\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n</code></pre>"},{"location":"about/license/#what-this-means","title":"What This Means","text":""},{"location":"about/license/#you-can","title":"You CAN:","text":"<ul> <li>\u2705 Use Doctrine Doctor in commercial projects</li> <li>\u2705 Modify the source code</li> <li>\u2705 Distribute your modifications</li> <li>\u2705 Use it in proprietary software</li> <li>\u2705 Grant sublicenses to others</li> </ul>"},{"location":"about/license/#you-must","title":"You MUST:","text":"<ul> <li>\u26a0\ufe0f Include the original license and copyright notice</li> <li>\u26a0\ufe0f State significant changes made to the software</li> </ul>"},{"location":"about/license/#you-cannot","title":"You CANNOT:","text":"<ul> <li>\u274c Hold the author liable for damages</li> <li>\u274c Use the author's name to promote your derivative work without permission</li> </ul>"},{"location":"about/license/#third-party-licenses","title":"Third-Party Licenses","text":"<p>Doctrine Doctor uses the following open-source dependencies:</p>"},{"location":"about/license/#symfony-components","title":"Symfony Components","text":"<ul> <li>License: MIT</li> <li>Copyright: Fabien Potencier</li> <li>symfony.com/doc/current/contributing/code/license.html</li> </ul>"},{"location":"about/license/#doctrine-orm","title":"Doctrine ORM","text":"<ul> <li>License: MIT</li> <li>Copyright: Doctrine Project</li> <li>doctrine-project.org</li> </ul>"},{"location":"about/license/#phpunit","title":"PHPUnit","text":"<ul> <li>License: BSD-3-Clause</li> <li>Copyright: Sebastian Bergmann</li> <li>phpunit.de</li> </ul>"},{"location":"about/license/#phpstan","title":"PHPStan","text":"<ul> <li>License: MIT</li> <li>Copyright: Ond\u0159ej Mirtes</li> <li>phpstan.org</li> </ul>"},{"location":"about/license/#contributing","title":"Contributing","text":"<p>By contributing to Doctrine Doctor, you agree that your contributions will be licensed under the MIT License.</p> <p>See Contributing Guidelines for more information.</p>"},{"location":"about/license/#questions","title":"Questions?","text":"<p>For licensing questions, please contact:</p> <ul> <li>Email: GitHub Issues</li> <li>GitHub: @ahmed-bhs</li> </ul> <p>\u2190 Home | Changelog \u2192</p>"},{"location":"contributing/creating-analyzers/","title":"Creating Custom Analyzers","text":"<p>Complete guide to creating your own analyzers for Doctrine Doctor.</p>"},{"location":"contributing/creating-analyzers/#analyzer-basics","title":"Analyzer Basics","text":"<p>An analyzer:</p> <ul> <li>Implements <code>AnalyzerInterface</code></li> <li>Receives query data from a request</li> <li>Returns a collection of issues</li> <li>Is stateless and independent</li> <li>Can be configured via YAML</li> </ul>"},{"location":"contributing/creating-analyzers/#step-by-step-guide","title":"Step-by-Step Guide","text":""},{"location":"contributing/creating-analyzers/#step-1-create-analyzer-class","title":"Step 1: Create Analyzer Class","text":"<pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\Analyzer;\n\nuse AhmedBhs\\DoctrineDoctor\\Analyzer\\AnalyzerInterface;\nuse AhmedBhs\\DoctrineDoctor\\Factory\\IssueFactoryInterface;\nuse AhmedBhs\\DoctrineDoctor\\Model\\IssueCollection;\nuse AhmedBhs\\DoctrineDoctor\\Model\\QueryDataCollection;\nuse AhmedBhs\\DoctrineDoctor\\Model\\Severity;\nuse AhmedBhs\\DoctrineDoctor\\Template\\Renderer\\TemplateRendererInterface;\n\nfinal class CustomAnalyzer implements AnalyzerInterface\n{\n    public function __construct(\n        private readonly IssueFactoryInterface $issueFactory,\n        private readonly TemplateRendererInterface $templateRenderer,\n        private readonly int $threshold = 100\n    ) {\n    }\n\n    public function analyze(QueryDataCollection $queryDataCollection): IssueCollection\n    {\n        $issues = new IssueCollection();\n\n        // Your analysis logic here\n        foreach ($queryDataCollection as $queryData) {\n            // Check for patterns\n            if ($this-&gt;detectsIssue($queryData)) {\n                $issues-&gt;add($this-&gt;createIssue($queryData));\n            }\n        }\n\n        return $issues;\n    }\n\n    private function detectsIssue($queryData): bool\n    {\n        // Detection logic\n        return false;\n    }\n\n    private function createIssue($queryData)\n    {\n        // Issue creation\n    }\n}\n</code></pre>"},{"location":"contributing/creating-analyzers/#step-2-register-as-service","title":"Step 2: Register as Service","text":"<pre><code># config/services.yaml\nservices:\n    App\\Analyzer\\CustomAnalyzer:\n        arguments:\n            $threshold: '%env(int:CUSTOM_ANALYZER_THRESHOLD)%'\n        tags:\n            - { name: 'doctrine_doctor.analyzer' }\n</code></pre>"},{"location":"contributing/creating-analyzers/#step-3-add-configuration","title":"Step 3: Add Configuration","text":"<pre><code>&lt;?php\n\n// config/packages/doctrine_doctor.yaml\ndoctrine_doctor:\n    analyzers:\n        custom_analyzer:\n            enabled: true\n            threshold: 100\n</code></pre>"},{"location":"contributing/creating-analyzers/#step-4-create-template-optional","title":"Step 4: Create Template (Optional)","text":"<pre><code>&lt;?php\n// templates/doctrine_doctor/custom_issue.php\n\n$code = &lt;&lt;&lt;CODE\n// Your suggestion code here\n\\$repository-&gt;createQueryBuilder('e')\n    -&gt;where('e.field = :value')\n    -&gt;setParameter('value', \\$value);\nCODE;\n\n$description = \"Detailed explanation of the issue and solution.\";\n\nreturn ['code' =&gt; $code, 'description' =&gt; $description];\n</code></pre>"},{"location":"contributing/creating-analyzers/#step-5-write-tests","title":"Step 5: Write Tests","text":"<pre><code>&lt;?php\n\nnamespace App\\Tests\\Analyzer;\n\nuse App\\Analyzer\\CustomAnalyzer;\nuse PHPUnit\\Framework\\TestCase;\n\nfinal class CustomAnalyzerTest extends TestCase\n{\n    public function testDetectsIssue(): void\n    {\n        // Arrange\n        $analyzer = new CustomAnalyzer(\n            $this-&gt;createMock(IssueFactoryInterface::class),\n            $this-&gt;createMock(TemplateRendererInterface::class),\n            threshold: 100\n        );\n\n        $queryDataCollection = $this-&gt;createQueryDataCollection();\n\n        // Act\n        $issues = $analyzer-&gt;analyze($queryDataCollection);\n\n        // Assert\n        $this-&gt;assertCount(1, $issues);\n    }\n\n    private function createQueryDataCollection()\n    {\n        // Helper to create test data\n    }\n}\n</code></pre>"},{"location":"contributing/creating-analyzers/#real-example-detecting-large-offset","title":"Real Example: Detecting Large OFFSET","text":"<p>Let's create an analyzer that detects inefficient OFFSET usage in pagination.</p>"},{"location":"contributing/creating-analyzers/#implementation","title":"Implementation","text":"<pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace App\\Analyzer\\Performance;\n\nuse AhmedBhs\\DoctrineDoctor\\Analyzer\\AnalyzerInterface;\nuse AhmedBhs\\DoctrineDoctor\\Factory\\IssueFactoryInterface;\nuse AhmedBhs\\DoctrineDoctor\\Model\\Issue;\nuse AhmedBhs\\DoctrineDoctor\\Model\\IssueCollection;\nuse AhmedBhs\\DoctrineDoctor\\Model\\QueryData;\nuse AhmedBhs\\DoctrineDoctor\\Model\\QueryDataCollection;\nuse AhmedBhs\\DoctrineDoctor\\Model\\Severity;\nuse AhmedBhs\\DoctrineDoctor\\Template\\Renderer\\TemplateRendererInterface;\n\n/**\n * Detects large OFFSET values in pagination queries.\n *\n * Large OFFSET values force the database to scan and skip many rows,\n * becoming exponentially slower as the offset increases.\n *\n * @author Your Name\n */\nfinal class LargeOffsetAnalyzer implements AnalyzerInterface\n{\n    private const TYPE = 'large_offset';\n    private const CATEGORY = 'performance';\n\n    public function __construct(\n        private readonly IssueFactoryInterface $issueFactory,\n        private readonly TemplateRendererInterface $templateRenderer,\n        private readonly int $offsetThreshold = 10000\n    ) {\n    }\n\n    public function analyze(QueryDataCollection $queryDataCollection): IssueCollection\n    {\n        $issues = new IssueCollection();\n\n        foreach ($queryDataCollection as $queryData) {\n            $offset = $this-&gt;extractOffset($queryData);\n\n            if ($offset &gt;= $this-&gt;offsetThreshold) {\n                $issues-&gt;add($this-&gt;createIssue($queryData, $offset));\n            }\n        }\n\n        return $issues;\n    }\n\n    private function extractOffset(QueryData $queryData): int\n    {\n        $sql = $queryData-&gt;getSql();\n\n        // Match OFFSET or LIMIT x,y syntax\n        if (preg_match('/OFFSET\\s+(\\d+)/i', $sql, $matches)) {\n            return (int) $matches[1];\n        }\n\n        if (preg_match('/LIMIT\\s+(\\d+)\\s*,\\s*(\\d+)/i', $sql, $matches)) {\n            return (int) $matches[1]; // First number is offset in LIMIT x,y\n        }\n\n        return 0;\n    }\n\n    private function createIssue(QueryData $queryData, int $offset): Issue\n    {\n        $severity = $this-&gt;calculateSeverity($offset);\n\n        $suggestion = $this-&gt;templateRenderer-&gt;render('large_offset', [\n            'offset' =&gt; $offset,\n            'threshold' =&gt; $this-&gt;offsetThreshold,\n            'execution_time' =&gt; $queryData-&gt;getExecutionTimeMs(),\n        ]);\n\n        return $this-&gt;issueFactory-&gt;create(\n            type: self::TYPE,\n            title: sprintf('Large OFFSET detected: %d rows', $offset),\n            description: sprintf(\n                'Query uses OFFSET %d, which forces the database to scan and skip %d rows. '\n                . 'This becomes exponentially slower as the offset increases.',\n                $offset,\n                $offset\n            ),\n            severity: $severity,\n            category: self::CATEGORY,\n            suggestion: $suggestion,\n            queries: [$queryData-&gt;getSql()],\n            backtrace: $queryData-&gt;getBacktrace(),\n            data: [\n                'offset' =&gt; $offset,\n                'threshold' =&gt; $this-&gt;offsetThreshold,\n                'execution_time_ms' =&gt; $queryData-&gt;getExecutionTimeMs(),\n            ]\n        );\n    }\n\n    private function calculateSeverity(int $offset): Severity\n    {\n        if ($offset &gt;= 50000) {\n            return Severity::CRITICAL;\n        }\n\n        if ($offset &gt;= 20000) {\n            return Severity::HIGH;\n        }\n\n        return Severity::MEDIUM;\n    }\n}\n</code></pre>"},{"location":"contributing/creating-analyzers/#template","title":"Template","text":"<pre><code>&lt;?php\n// templates/doctrine_doctor/large_offset.php\n\n/** @var array{offset: int, threshold: int, execution_time: float} $context */\n\n$offset = $context['offset'];\n$executionTime = $context['execution_time'];\n\nob_start();\n?&gt;\n## Issue: Large OFFSET in Pagination\n\nYour query uses `OFFSET &lt;?= $offset ?&gt;`, which forces the database to:\n1. Scan &lt;?= $offset ?&gt; rows\n2. Skip them all\n3. Then return the actual results\n\n**Execution time**: &lt;?= number_format($executionTime, 2) ?&gt;ms\n\n## Solution: Cursor-Based Pagination\n\nInstead of OFFSET, use the last ID from the previous page:\n\n```php\n// Instead of:\n$query = $repository\n    -&gt;createQueryBuilder('e')\n    -&gt;orderBy('e.id', 'ASC')\n    -&gt;setFirstResult(&lt;?= $offset ?&gt;)  // Slow!\n    -&gt;setMaxResults(20);\n\n// Use:\n$query = $repository\n    -&gt;createQueryBuilder('e')\n    -&gt;where('e.id &gt; :lastId')\n    -&gt;setParameter('lastId', $lastSeenId)\n    -&gt;orderBy('e.id', 'ASC')\n    -&gt;setMaxResults(20);\n</code></pre> <p>Benefits: - Constant time complexity O(1) - Works efficiently with millions of rows - No performance degradation on deep pages</p>  $code,     'description' =&gt; 'Use cursor-based pagination instead of OFFSET for better performance' ]; <pre><code>### Configuration\n\n```yaml\n# config/packages/doctrine_doctor.yaml\ndoctrine_doctor:\n    analyzers:\n        large_offset:\n            enabled: true\n            offset_threshold: 10000\n</code></pre>  ### Tests  <pre><code>&lt;?php\n\nnamespace App\\Tests\\Analyzer\\Performance;\n\nuse App\\Analyzer\\Performance\\LargeOffsetAnalyzer;\nuse AhmedBhs\\DoctrineDoctor\\Model\\QueryData;\nuse AhmedBhs\\DoctrineDoctor\\Model\\QueryDataCollection;\nuse PHPUnit\\Framework\\TestCase;\n\nfinal class LargeOffsetAnalyzerTest extends TestCase\n{\n    public function testDetectsLargeOffset(): void\n    {\n        $analyzer = $this-&gt;createAnalyzer(offsetThreshold: 10000);\n\n        $queryData = new QueryData(\n            sql: 'SELECT * FROM user LIMIT 20 OFFSET 15000',\n            executionTimeMs: 234.5\n        );\n\n        $collection = new QueryDataCollection([$queryData]);\n        $issues = $analyzer-&gt;analyze($collection);\n\n        $this-&gt;assertCount(1, $issues);\n        $this-&gt;assertSame('large_offset', $issues-&gt;first()-&gt;getType());\n    }\n\n    public function testIgnoresSmallOffset(): void\n    {\n        $analyzer = $this-&gt;createAnalyzer(offsetThreshold: 10000);\n\n        $queryData = new QueryData(\n            sql: 'SELECT * FROM user LIMIT 20 OFFSET 100',\n            executionTimeMs: 5.2\n        );\n\n        $collection = new QueryDataCollection([$queryData]);\n        $issues = $analyzer-&gt;analyze($collection);\n\n        $this-&gt;assertCount(0, $issues);\n    }\n\n    public function testSeverityIncreaseWithOffset(): void\n    {\n        $analyzer = $this-&gt;createAnalyzer(offsetThreshold: 10000);\n\n        $queryData = new QueryData(\n            sql: 'SELECT * FROM user LIMIT 20 OFFSET 60000',\n            executionTimeMs: 1234.5\n        );\n\n        $collection = new QueryDataCollection([$queryData]);\n        $issues = $analyzer-&gt;analyze($collection);\n\n        $this-&gt;assertSame('critical', $issues-&gt;first()-&gt;getSeverity()-&gt;value);\n    }\n\n    private function createAnalyzer(int $offsetThreshold): LargeOffsetAnalyzer\n    {\n        return new LargeOffsetAnalyzer(\n            $this-&gt;createMock(IssueFactoryInterface::class),\n            $this-&gt;createMock(TemplateRendererInterface::class),\n            $offsetThreshold\n        );\n    }\n}\n</code></pre>  ---  ## Best Practices  ### 1. Single Responsibility  Each analyzer should detect ONE type of issue:  <pre><code>// Good\nclass NPlusOneAnalyzer { }\nclass MissingIndexAnalyzer { }\n\n// Bad\nclass PerformanceAnalyzer { } // Too broad\n</code></pre>  ### 2. Configurable Thresholds  Allow users to adjust sensitivity:  <pre><code>public function __construct(\n    private readonly int $threshold = 100\n) {\n}\n</code></pre>  ### 3. Clear Severity Levels  Use appropriate severity:  - **Critical**: Security issues, data loss - **High**: Major performance problems - **Medium**: Suboptimal patterns - **Low**: Minor improvements  ### 4. Actionable Suggestions  Provide concrete code examples:  <pre><code>$suggestion = $this-&gt;templateRenderer-&gt;render('fix_template', [\n    'before' =&gt; $problematicCode,\n    'after' =&gt; $fixedCode,\n]);\n</code></pre>  ### 5. Include Context  Add metadata for debugging:  <pre><code>return $this-&gt;issueFactory-&gt;create(\n    // ...\n    data: [\n        'query_count' =&gt; $count,\n        'execution_time_ms' =&gt; $time,\n        'affected_entities' =&gt; $entities,\n    ]\n);\n</code></pre>  ---  ## Analyzer Categories  ### Performance Analyzers  Focus on:  - Query efficiency - Resource usage - Database load  ### Security Analyzers  Focus on:  - SQL injection - Data exposure - Insecure patterns  ### Integrity Analyzers  Focus on:  - Data consistency - Relationship correctness - Mapping accuracy  ### Configuration Analyzers  Focus on:  - Database settings - Entity configuration - Doctrine configuration  ---  ## Testing Strategies  ### Unit Tests  Test analyzer logic in isolation:  <pre><code>public function testDetectionLogic(): void\n{\n    $analyzer = new MyAnalyzer();\n    $issues = $analyzer-&gt;analyze($testData);\n    $this-&gt;assertCount(1, $issues);\n}\n</code></pre>  ### Integration Tests  Test with real Doctrine queries:  <pre><code>public function testWithRealQueries(): void\n{\n    $em = $this-&gt;createEntityManager();\n    // Execute real queries\n    // Analyze with collector\n    // Assert issues detected\n}\n</code></pre>  ### Edge Cases  Test boundary conditions:  <pre><code>public function testThresholdBoundary(): void\n{\n    // Test at threshold - 1\n    // Test at threshold\n    // Test at threshold + 1\n}\n</code></pre>  ---  ## Documentation  Document your analyzer:  <pre><code>/**\n * Detects inefficient pagination with large OFFSET values.\n *\n * Large OFFSET forces the database to scan and skip many rows,\n * becoming exponentially slower as the offset increases.\n *\n * **Configuration**:\n * ```yaml\n * doctrine_doctor:\n *     analyzers:\n *         large_offset:\n *             offset_threshold: 10000\n * ```\n *\n * **Example Issue**:\n * ```sql\n * SELECT * FROM user LIMIT 20 OFFSET 50000\n * ```\n *\n * **Suggested Fix**:\n * Use cursor-based pagination instead of OFFSET.\n *\n * @author Your Name &lt;email@example.com&gt;\n */\n</code></pre>  ---  ## Contributing Your Analyzer  1. Create PR with analyzer code 2. Include tests 3. Add documentation 4. Update ANALYZERS.md 5. Add example use cases  ---  **[\u2190 Development Setup](development.md)** | **[Configuration \u2192](../CONFIGURATION.md)**   ?&gt;"},{"location":"contributing/development/","title":"Development Setup","text":"<p>Complete guide to setting up Doctrine Doctor for local development.</p>"},{"location":"contributing/development/#prerequisites","title":"Prerequisites","text":"<ul> <li>PHP: 8.2 or higher</li> <li>Composer: 2.0+</li> <li>Git: Latest version</li> <li>IDE: PHPStorm, VS Code, or your preference</li> </ul>"},{"location":"contributing/development/#fork-and-clone","title":"Fork and Clone","text":""},{"location":"contributing/development/#1-fork-the-repository","title":"1. Fork the Repository","text":"<p>Click the \"Fork\" button on GitHub</p>"},{"location":"contributing/development/#2-clone-your-fork","title":"2. Clone Your Fork","text":"<pre><code>git clone https://github.com/YOUR-USERNAME/doctrine-doctor.git\ncd doctrine-doctor\n</code></pre>"},{"location":"contributing/development/#3-add-upstream-remote","title":"3. Add Upstream Remote","text":"<pre><code>git remote add upstream https://github.com/ahmed-bhs/doctrine-doctor.git\n</code></pre>"},{"location":"contributing/development/#install-dependencies","title":"Install Dependencies","text":"<pre><code>composer install\n</code></pre> <p>This installs:</p> <ul> <li>PHPUnit for testing</li> <li>PHPStan for static analysis</li> <li>PHP-CS-Fixer for code style</li> <li>Development dependencies</li> </ul>"},{"location":"contributing/development/#project-structure","title":"Project Structure","text":"<pre><code>doctrine-doctor/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 Analyzer/          # All analyzers\n\u2502   \u2502   \u251c\u2500\u2500 Performance/   # Performance analyzers\n\u2502   \u2502   \u251c\u2500\u2500 Security/      # Security analyzers\n\u2502   \u2502   \u251c\u2500\u2500 Integrity/     # Data integrity analyzers\n\u2502   \u2502   \u2514\u2500\u2500 Configuration/ # Configuration analyzers\n\u2502   \u251c\u2500\u2500 Collector/         # Data collectors\n\u2502   \u251c\u2500\u2500 Factory/           # Issue factories\n\u2502   \u251c\u2500\u2500 Model/             # Domain models\n\u2502   \u251c\u2500\u2500 Template/          # Template rendering\n\u2502   \u2514\u2500\u2500 DoctrineDoctorBundle.php\n\u251c\u2500\u2500 tests/                 # Unit and integration tests\n\u251c\u2500\u2500 config/                # Bundle configuration\n\u2514\u2500\u2500 docs/                  # Documentation\n</code></pre>"},{"location":"contributing/development/#running-tests","title":"Running Tests","text":""},{"location":"contributing/development/#all-tests","title":"All Tests","text":"<pre><code>vendor/bin/phpunit\n</code></pre>"},{"location":"contributing/development/#specific-test-suite","title":"Specific Test Suite","text":"<pre><code>vendor/bin/phpunit --testsuite=unit\nvendor/bin/phpunit --testsuite=integration\n</code></pre>"},{"location":"contributing/development/#single-test-file","title":"Single Test File","text":"<pre><code>vendor/bin/phpunit tests/Analyzer/Performance/NPlusOneAnalyzerTest.php\n</code></pre>"},{"location":"contributing/development/#with-coverage","title":"With Coverage","text":"<pre><code>vendor/bin/phpunit --coverage-html coverage/\n</code></pre> <p>Open <code>coverage/index.html</code> in your browser.</p>"},{"location":"contributing/development/#static-analysis","title":"Static Analysis","text":""},{"location":"contributing/development/#run-phpstan","title":"Run PHPStan","text":"<pre><code>vendor/bin/phpstan analyse\n</code></pre>"},{"location":"contributing/development/#phpstan-level","title":"PHPStan Level","text":"<p>Doctrine Doctor uses Level 8 (maximum strictness):</p> <pre><code># phpstan.neon\nparameters:\n    level: 8\n</code></pre>"},{"location":"contributing/development/#code-style","title":"Code Style","text":""},{"location":"contributing/development/#check-code-style","title":"Check Code Style","text":"<pre><code>vendor/bin/php-cs-fixer fix --dry-run --diff\n</code></pre>"},{"location":"contributing/development/#auto-fix-code-style","title":"Auto-Fix Code Style","text":"<pre><code>vendor/bin/php-cs-fixer fix\n</code></pre>"},{"location":"contributing/development/#configuration","title":"Configuration","text":"<p>Code style follows PSR-12:</p> <pre><code>// .php-cs-fixer.dist.php\n&lt;?php\n\n$finder = PhpCsFixer\\Finder::create()\n    -&gt;in(__DIR__ . '/src')\n    -&gt;in(__DIR__ . '/tests');\n\nreturn (new PhpCsFixer\\Config())\n    -&gt;setRules([\n        '@PSR12' =&gt; true,\n        '@Symfony' =&gt; true,\n        'strict_param' =&gt; true,\n        'array_syntax' =&gt; ['syntax' =&gt; 'short'],\n    ])\n    -&gt;setFinder($finder);\n</code></pre>"},{"location":"contributing/development/#development-workflow","title":"Development Workflow","text":""},{"location":"contributing/development/#1-create-feature-branch","title":"1. Create Feature Branch","text":"<pre><code>git checkout -b feature/my-new-analyzer\n</code></pre>"},{"location":"contributing/development/#2-make-changes","title":"2. Make Changes","text":"<p>Edit files in <code>src/</code> directory.</p>"},{"location":"contributing/development/#3-run-quality-checks","title":"3. Run Quality Checks","text":"<pre><code># Tests\nvendor/bin/phpunit\n\n# Static analysis\nvendor/bin/phpstan analyse\n\n# Code style\nvendor/bin/php-cs-fixer fix\n</code></pre>"},{"location":"contributing/development/#4-commit-changes","title":"4. Commit Changes","text":"<pre><code>git add .\ngit commit -m \"feat: add XYZ analyzer\"\n</code></pre>"},{"location":"contributing/development/#5-push-to-your-fork","title":"5. Push to Your Fork","text":"<pre><code>git push origin feature/my-new-analyzer\n</code></pre>"},{"location":"contributing/development/#6-create-pull-request","title":"6. Create Pull Request","text":"<p>Go to GitHub and create a PR from your fork to the main repository.</p>"},{"location":"contributing/development/#testing-with-a-real-symfony-project","title":"Testing with a Real Symfony Project","text":""},{"location":"contributing/development/#1-create-test-symfony-project","title":"1. Create Test Symfony Project","text":"<pre><code>symfony new test-app\ncd test-app\n</code></pre>"},{"location":"contributing/development/#2-link-local-doctrine-doctor","title":"2. Link Local Doctrine Doctor","text":"<p>Edit <code>composer.json</code>:</p> <pre><code>{\n    \"repositories\": [\n        {\n            \"type\": \"path\",\n            \"url\": \"../doctrine-doctor\"\n        }\n    ]\n}\n</code></pre>"},{"location":"contributing/development/#3-require-local-version","title":"3. Require Local Version","text":"<pre><code>composer require ahmed-bhs/doctrine-doctor:@dev --dev\n</code></pre>"},{"location":"contributing/development/#4-test-your-changes","title":"4. Test Your Changes","text":"<p>Create entities and controllers, then check the Web Profiler.</p>"},{"location":"contributing/development/#debugging","title":"Debugging","text":""},{"location":"contributing/development/#enable-debug-output","title":"Enable Debug Output","text":"<pre><code># config/packages/dev/doctrine_doctor.yaml\ndoctrine_doctor:\n    profiler:\n        show_debug_info: true\n</code></pre>"},{"location":"contributing/development/#dump-variables","title":"Dump Variables","text":"<pre><code>&lt;?php\n\nuse Symfony\\Component\\VarDumper\\VarDumper;\n\nVarDumper::dump($issues);\n</code></pre>"},{"location":"contributing/development/#xdebug","title":"Xdebug","text":"<p>Configure Xdebug in <code>php.ini</code>:</p> <pre><code>zend_extension=xdebug.so\nxdebug.mode=debug\nxdebug.start_with_request=yes\n</code></pre>"},{"location":"contributing/development/#ide-configuration","title":"IDE Configuration","text":""},{"location":"contributing/development/#phpstorm","title":"PHPStorm","text":"<ol> <li>Install Symfony Plugin</li> <li>Configure PHP Interpreter: Settings \u2192 PHP \u2192 CLI Interpreter</li> <li>Enable PHPStan: Settings \u2192 PHP \u2192 Quality Tools</li> <li>Configure Code Style: Settings \u2192 Editor \u2192 Code Style \u2192 PHP</li> </ol> <p>Import <code>.editorconfig</code> for automatic formatting.</p>"},{"location":"contributing/development/#vs-code","title":"VS Code","text":"<p>Install extensions:</p> <pre><code>code --install-extension bmewburn.vscode-intelephense-client\ncode --install-extension wongjn.php-sniffer\ncode --install-extension sanderrock.phpstan\n</code></pre>"},{"location":"contributing/development/#continuous-integration","title":"Continuous Integration","text":"<p>GitHub Actions runs on every push:</p> <pre><code># .github/workflows/ci.yml\nname: CI\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      - uses: shivammathur/setup-php@v2\n        with:\n          php-version: '8.2'\n      - run: composer install\n      - run: vendor/bin/phpunit\n      - run: vendor/bin/phpstan analyse\n</code></pre>"},{"location":"contributing/development/#common-issues","title":"Common Issues","text":""},{"location":"contributing/development/#composer-install-fails","title":"Composer Install Fails","text":"<pre><code># Clear cache\ncomposer clear-cache\n\n# Install with verbose output\ncomposer install -vvv\n</code></pre>"},{"location":"contributing/development/#phpstan-errors","title":"PHPStan Errors","text":"<pre><code># Clear result cache\nvendor/bin/phpstan clear-result-cache\n\n# Run again\nvendor/bin/phpstan analyse\n</code></pre>"},{"location":"contributing/development/#tests-fail","title":"Tests Fail","text":"<pre><code># Clear test cache\nphp bin/phpunit --cache-result-file=/tmp/phpunit.cache\n\n# Run with verbose output\nvendor/bin/phpunit --verbose\n</code></pre>"},{"location":"contributing/development/#documentation","title":"Documentation","text":""},{"location":"contributing/development/#update-documentation","title":"Update Documentation","text":"<p>Edit files in <code>docs/</code> directory using Markdown.</p>"},{"location":"contributing/development/#preview-documentation-locally","title":"Preview Documentation Locally","text":"<pre><code># Install MkDocs\npip install mkdocs-material\n\n# Serve locally\nmkdocs serve\n</code></pre> <p>Open http://127.0.0.1:8000</p>"},{"location":"contributing/development/#build-documentation","title":"Build Documentation","text":"<pre><code>mkdocs build\n</code></pre>"},{"location":"contributing/development/#release-process-maintainers-only","title":"Release Process (Maintainers Only)","text":"<ol> <li>Update version in code</li> <li>Update CHANGELOG.md</li> <li>Create git tag</li> <li>Push to GitHub</li> <li>Create GitHub Release</li> <li>Packagist auto-updates</li> </ol>"},{"location":"contributing/development/#getting-help","title":"Getting Help","text":"<ul> <li>Questions: GitHub Discussions</li> <li>Issues: GitHub Issues</li> <li>Documentation: Read the Docs</li> </ul> <p>\u2190 Contributing Overview | Creating Analyzers \u2192</p>"},{"location":"contributing/overview/","title":"Contributing to Doctrine Doctor","text":"<p>We welcome contributions from the community! This guide will help you get started.</p>"},{"location":"contributing/overview/#ways-to-contribute","title":"Ways to Contribute","text":""},{"location":"contributing/overview/#report-bugs","title":"\ud83d\udc1b Report Bugs","text":"<p>Found a bug? Open an issue with:</p> <ul> <li>Clear title and description</li> <li>Steps to reproduce</li> <li>Expected vs actual behavior</li> <li>PHP/Symfony/Doctrine versions</li> <li>Code samples if applicable</li> </ul>"},{"location":"contributing/overview/#suggest-features","title":"\ud83d\udca1 Suggest Features","text":"<p>Have an idea for a new analyzer or feature?</p> <ol> <li>Check existing issues first</li> <li>Open a new issue with the <code>enhancement</code> label</li> <li>Describe the use case and expected behavior</li> </ol>"},{"location":"contributing/overview/#improve-documentation","title":"\ud83d\udcdd Improve Documentation","text":"<p>Documentation improvements are always welcome:</p> <ul> <li>Fix typos or unclear explanations</li> <li>Add examples</li> <li>Improve code samples</li> <li>Translate to other languages</li> </ul>"},{"location":"contributing/overview/#submit-code","title":"\ud83d\udd27 Submit Code","text":"<p>Want to contribute code? Great!</p> <ol> <li>Fork the repository</li> <li>Create a feature branch</li> <li>Make your changes</li> <li>Submit a pull request</li> </ol>"},{"location":"contributing/overview/#development-workflow","title":"Development Workflow","text":""},{"location":"contributing/overview/#1-setup-development-environment","title":"1. Setup Development Environment","text":"<p>See Development Setup for detailed instructions.</p>"},{"location":"contributing/overview/#2-choose-an-issue","title":"2. Choose an Issue","text":"<ul> <li>Check good first issues</li> <li>Comment on the issue to claim it</li> <li>Ask questions if anything is unclear</li> </ul>"},{"location":"contributing/overview/#3-create-a-branch","title":"3. Create a Branch","text":"<pre><code>git checkout -b feature/your-feature-name\n# or\ngit checkout -b fix/issue-number-description\n</code></pre>"},{"location":"contributing/overview/#4-make-changes","title":"4. Make Changes","text":"<ul> <li>Write clean, readable code</li> <li>Follow PSR-12 coding standards</li> <li>Add tests for new features</li> <li>Update documentation</li> </ul>"},{"location":"contributing/overview/#5-test-your-changes","title":"5. Test Your Changes","text":"<pre><code># Run tests\nvendor/bin/phpunit\n\n# Run static analysis\nvendor/bin/phpstan analyse\n\n# Run code style checks\nvendor/bin/php-cs-fixer fix --dry-run\n</code></pre>"},{"location":"contributing/overview/#6-commit-your-changes","title":"6. Commit Your Changes","text":"<p>Follow Conventional Commits:</p> <pre><code>git commit -m \"feat: add new analyzer for detecting unused indexes\"\ngit commit -m \"fix: correct N+1 detection threshold logic\"\ngit commit -m \"docs: add examples for security analyzers\"\n</code></pre>"},{"location":"contributing/overview/#7-push-and-create-pr","title":"7. Push and Create PR","text":"<pre><code>git push origin feature/your-feature-name\n</code></pre> <p>Then create a pull request on GitHub with:</p> <ul> <li>Clear title describing the change</li> <li>Reference to related issue (if applicable)</li> <li>Description of changes made</li> <li>Screenshots/examples if relevant</li> </ul>"},{"location":"contributing/overview/#code-standards","title":"Code Standards","text":""},{"location":"contributing/overview/#coding-style","title":"Coding Style","text":"<ul> <li>Follow PSR-12</li> <li>Use type declarations</li> <li>Write PHPDoc for classes and methods</li> <li>Use meaningful variable names</li> </ul> <p>Example:</p> <pre><code>&lt;?php\n\ndeclare(strict_types=1);\n\nnamespace AhmedBhs\\DoctrineDoctor\\Analyzer\\Performance;\n\nuse AhmedBhs\\DoctrineDoctor\\Analyzer\\AnalyzerInterface;\nuse AhmedBhs\\DoctrineDoctor\\Model\\IssueCollection;\nuse AhmedBhs\\DoctrineDoctor\\Model\\QueryDataCollection;\n\n/**\n * Detects N+1 query problems.\n *\n * @author Ahmed EBEN HASSINE\n */\nfinal class NPlusOneAnalyzer implements AnalyzerInterface\n{\n    public function __construct(\n        private readonly int $threshold = 5\n    ) {\n    }\n\n    /**\n     * @param QueryDataCollection $queryDataCollection\n     * @return IssueCollection\n     */\n    public function analyze(QueryDataCollection $queryDataCollection): IssueCollection\n    {\n        // Implementation\n    }\n}\n</code></pre>"},{"location":"contributing/overview/#testing","title":"Testing","text":"<ul> <li>Write unit tests for new analyzers</li> <li>Maintain code coverage above 80%</li> <li>Test edge cases</li> <li>Use meaningful test names</li> </ul> <pre><code>&lt;?php\n\nnamespace AhmedBhs\\DoctrineDoctor\\Tests\\Analyzer\\Performance;\n\nuse PHPUnit\\Framework\\TestCase;\n\nfinal class NPlusOneAnalyzerTest extends TestCase\n{\n    public function testDetectsNPlusOneQueryPattern(): void\n    {\n        // Arrange\n        $analyzer = new NPlusOneAnalyzer(threshold: 5);\n        $queryData = $this-&gt;createNPlusOneScenario();\n\n        // Act\n        $issues = $analyzer-&gt;analyze($queryData);\n\n        // Assert\n        $this-&gt;assertCount(1, $issues);\n        $this-&gt;assertSame('n_plus_one', $issues-&gt;first()-&gt;getType());\n    }\n}\n</code></pre>"},{"location":"contributing/overview/#documentation","title":"Documentation","text":"<ul> <li>Add PHPDoc to all public methods</li> <li>Update README.md if adding features</li> <li>Add examples for new analyzers</li> <li>Keep CHANGELOG.md updated</li> </ul>"},{"location":"contributing/overview/#pull-request-guidelines","title":"Pull Request Guidelines","text":""},{"location":"contributing/overview/#before-submitting","title":"Before Submitting","text":"<ul> <li> Code follows PSR-12 standards</li> <li> All tests pass</li> <li> PHPStan analysis passes (Level 8)</li> <li> Documentation updated</li> <li> CHANGELOG.md updated (if applicable)</li> </ul>"},{"location":"contributing/overview/#pr-description-template","title":"PR Description Template","text":"<pre><code>## Description\nBrief description of changes\n\n## Type of Change\n- [ ] Bug fix\n- [ ] New feature\n- [ ] Breaking change\n- [ ] Documentation update\n\n## Related Issue\nCloses #123\n\n## Testing\nDescribe how you tested the changes\n\n## Screenshots (if applicable)\nAdd screenshots for UI changes\n</code></pre>"},{"location":"contributing/overview/#code-review-process","title":"Code Review Process","text":"<ol> <li>Automated Checks: CI runs tests, PHPStan, and code style checks</li> <li>Manual Review: Maintainers review code quality and design</li> <li>Feedback: Address any requested changes</li> <li>Approval: Once approved, your PR will be merged</li> <li>Release: Changes will be included in the next release</li> </ol>"},{"location":"contributing/overview/#creating-new-analyzers","title":"Creating New Analyzers","text":"<p>See detailed guide: Creating Analyzers</p> <p>Quick overview:</p> <ol> <li>Implement <code>AnalyzerInterface</code></li> <li>Add analyzer class to appropriate namespace</li> <li>Register as service with tag</li> <li>Write tests</li> <li>Add documentation</li> </ol>"},{"location":"contributing/overview/#community-guidelines","title":"Community Guidelines","text":""},{"location":"contributing/overview/#be-respectful","title":"Be Respectful","text":"<ul> <li>Be kind and courteous</li> <li>Accept constructive criticism</li> <li>Focus on what is best for the community</li> <li>Show empathy towards others</li> </ul>"},{"location":"contributing/overview/#be-patient","title":"Be Patient","text":"<ul> <li>Reviewers are volunteers</li> <li>Response time varies</li> <li>Complex PRs take longer to review</li> </ul>"},{"location":"contributing/overview/#be-clear","title":"Be Clear","text":"<ul> <li>Write clear commit messages</li> <li>Provide context in PRs</li> <li>Ask questions if unsure</li> </ul>"},{"location":"contributing/overview/#recognition","title":"Recognition","text":"<p>Contributors are recognized in:</p> <ul> <li>CHANGELOG.md</li> <li>Release notes</li> <li>GitHub contributors page</li> </ul>"},{"location":"contributing/overview/#getting-help","title":"Getting Help","text":"<ul> <li>Questions: Open a discussion</li> <li>Bugs: Open an issue</li> <li>Chat: Join our community channels (coming soon)</li> </ul>"},{"location":"contributing/overview/#license","title":"License","text":"<p>By contributing, you agree that your contributions will be licensed under the MIT License.</p> <p>Development Setup \u2192 | Creating Analyzers \u2192</p>"},{"location":"examples/missing-indexes/","title":"Missing Index Detection Examples","text":"<p>Learn how Doctrine Doctor identifies missing database indexes and improves query performance.</p>"},{"location":"examples/missing-indexes/#what-is-a-missing-index","title":"What is a Missing Index?","text":"<p>A missing index forces the database to perform a full table scan, reading every row to find matches. This becomes exponentially slower as tables grow.</p> <p>Impact:</p> <ul> <li>Development (100 rows): 5ms \u2192 acceptable</li> <li>Production (1M rows): 5,000ms \u2192 unacceptable</li> </ul>"},{"location":"examples/missing-indexes/#how-detection-works","title":"How Detection Works","text":"<p>Doctrine Doctor uses <code>EXPLAIN</code> queries to analyze execution plans:</p> <pre><code>EXPLAIN SELECT * FROM article WHERE status = 'published'\n</code></pre> <p>Signs of missing index:</p> <ul> <li><code>type: ALL</code> (full table scan)</li> <li><code>rows: 1000000</code> (scanning many rows)</li> <li><code>key: NULL</code> (no index used)</li> </ul>"},{"location":"examples/missing-indexes/#example-1-simple-where-clause","title":"Example 1: Simple WHERE Clause","text":""},{"location":"examples/missing-indexes/#problem-code","title":"Problem Code","text":"<pre><code>&lt;?php\n// src/Repository/ArticleRepository.php\n\npublic function findPublished(): array\n{\n    return $this-&gt;createQueryBuilder('a')\n        -&gt;where('a.status = :status')\n        -&gt;setParameter('status', 'published')\n        -&gt;getQuery()\n        -&gt;getResult();\n}\n</code></pre>"},{"location":"examples/missing-indexes/#entity-without-index","title":"Entity Without Index","text":"<pre><code>&lt;?php\n// src/Entity/Article.php\n\n#[ORM\\Entity]\nclass Article\n{\n    #[ORM\\Column(type: 'string')]\n    private string $status;  // No index!\n\n    // ...\n}\n</code></pre>"},{"location":"examples/missing-indexes/#doctrine-doctor-detection","title":"Doctrine Doctor Detection","text":"<pre><code>\ud83d\udd34 Critical: Missing Index Detected\n\nQuery: SELECT * FROM article WHERE status = ?\nRows scanned: 50,000\nExecution time: 234ms\n\nSuggested index:\nALTER TABLE article ADD INDEX idx_status (status);\n</code></pre>"},{"location":"examples/missing-indexes/#solution","title":"Solution","text":"<p>Add index annotation:</p> <pre><code>&lt;?php\n\n#[ORM\\Entity]\n#[ORM\\Index(name: 'idx_status', columns: ['status'])]\nclass Article\n{\n    #[ORM\\Column(type: 'string')]\n    private string $status;\n\n    // ...\n}\n</code></pre> <p>Or directly in MySQL:</p> <pre><code>ALTER TABLE article ADD INDEX idx_status (status);\n</code></pre>"},{"location":"examples/missing-indexes/#after-adding-index","title":"After Adding Index","text":"<pre><code>Query: SELECT * FROM article WHERE status = ?\nRows scanned: 8,500 (only matching rows)\nExecution time: 12ms\n\nImprovement: 95% faster\n</code></pre>"},{"location":"examples/missing-indexes/#example-2-composite-index-multiple-columns","title":"Example 2: Composite Index (Multiple Columns)","text":""},{"location":"examples/missing-indexes/#problem-code_1","title":"Problem Code","text":"<pre><code>&lt;?php\n\npublic function findByUserAndStatus(User $user, string $status): array\n{\n    return $this-&gt;createQueryBuilder('a')\n        -&gt;where('a.author = :author')\n        -&gt;andWhere('a.status = :status')\n        -&gt;setParameter('author', $user)\n        -&gt;setParameter('status', $status)\n        -&gt;getQuery()\n        -&gt;getResult();\n}\n</code></pre>"},{"location":"examples/missing-indexes/#entity-with-single-column-indexes","title":"Entity With Single Column Indexes","text":"<pre><code>&lt;?php\n\n#[ORM\\Entity]\n#[ORM\\Index(name: 'idx_author', columns: ['author_id'])]\n#[ORM\\Index(name: 'idx_status', columns: ['status'])]\nclass Article\n{\n    #[ORM\\ManyToOne(targetEntity: User::class)]\n    private User $author;\n\n    #[ORM\\Column(type: 'string')]\n    private string $status;\n}\n</code></pre>"},{"location":"examples/missing-indexes/#doctrine-doctor-detection_1","title":"Doctrine Doctor Detection","text":"<pre><code>\ud83d\udfe0 High: Suboptimal Index Usage\n\nQuery uses multiple WHERE conditions but only one index.\nConsider a composite index for better performance.\n\nSuggested composite index:\nALTER TABLE article ADD INDEX idx_author_status (author_id, status);\n</code></pre>"},{"location":"examples/missing-indexes/#solution_1","title":"Solution","text":"<pre><code>&lt;?php\n\n#[ORM\\Entity]\n#[ORM\\Index(name: 'idx_author_status', columns: ['author_id', 'status'])]\nclass Article\n{\n    #[ORM\\ManyToOne(targetEntity: User::class)]\n    private User $author;\n\n    #[ORM\\Column(type: 'string')]\n    private string $status;\n}\n</code></pre> <p>Index Column Order Matters:</p> <ul> <li><code>(author_id, status)</code> - Good for queries filtering by author, or author+status</li> <li><code>(status, author_id)</code> - Good for queries filtering by status, or status+author</li> </ul> <p>Choose based on your most common query patterns.</p>"},{"location":"examples/missing-indexes/#example-3-foreign-key-without-index","title":"Example 3: Foreign Key Without Index","text":""},{"location":"examples/missing-indexes/#problem-code_2","title":"Problem Code","text":"<pre><code>&lt;?php\n\npublic function findByCategory(Category $category): array\n{\n    return $this-&gt;createQueryBuilder('a')\n        -&gt;where('a.category = :category')\n        -&gt;setParameter('category', $category)\n        -&gt;getQuery()\n        -&gt;getResult();\n}\n</code></pre>"},{"location":"examples/missing-indexes/#entity-without-foreign-key-index","title":"Entity Without Foreign Key Index","text":"<pre><code>&lt;?php\n\n#[ORM\\Entity]\nclass Article\n{\n    #[ORM\\ManyToOne(targetEntity: Category::class)]\n    #[ORM\\JoinColumn(nullable: false)]\n    private Category $category;  // Foreign key without index!\n}\n</code></pre>"},{"location":"examples/missing-indexes/#doctrine-doctor-detection_2","title":"Doctrine Doctor Detection","text":"<pre><code>\ud83d\udd34 Critical: Missing Foreign Key Index\n\nTable: article\nForeign key: category_id\nRows scanned: 120,000\n\nThis severely impacts JOIN performance.\n\nSuggested index:\nALTER TABLE article ADD INDEX idx_category (category_id);\n</code></pre>"},{"location":"examples/missing-indexes/#solution_2","title":"Solution","text":"<pre><code>&lt;?php\n\n#[ORM\\Entity]\n#[ORM\\Index(name: 'idx_category', columns: ['category_id'])]\nclass Article\n{\n    #[ORM\\ManyToOne(targetEntity: Category::class)]\n    #[ORM\\JoinColumn(nullable: false)]\n    private Category $category;\n}\n</code></pre> <p>Automatic Indexes</p> <p>Some databases (like MySQL InnoDB) automatically create indexes on foreign keys. However, it's best to be explicit.</p>"},{"location":"examples/missing-indexes/#example-4-sorting-without-index","title":"Example 4: Sorting Without Index","text":""},{"location":"examples/missing-indexes/#problem-code_3","title":"Problem Code","text":"<pre><code>&lt;?php\n\npublic function findLatest(int $limit = 10): array\n{\n    return $this-&gt;createQueryBuilder('a')\n        -&gt;orderBy('a.publishedAt', 'DESC')\n        -&gt;setMaxResults($limit)\n        -&gt;getQuery()\n        -&gt;getResult();\n}\n</code></pre>"},{"location":"examples/missing-indexes/#entity-without-sort-index","title":"Entity Without Sort Index","text":"<pre><code>&lt;?php\n\n#[ORM\\Entity]\nclass Article\n{\n    #[ORM\\Column(type: 'datetime')]\n    private \\DateTimeInterface $publishedAt;  // No index!\n}\n</code></pre>"},{"location":"examples/missing-indexes/#doctrine-doctor-detection_3","title":"Doctrine Doctor Detection","text":"<pre><code>\ud83d\udfe0 High: Missing Index for Sorting\n\nQuery uses ORDER BY published_at without index.\nCauses filesort for large tables.\n\nSuggested index:\nALTER TABLE article ADD INDEX idx_published_at (published_at);\n</code></pre>"},{"location":"examples/missing-indexes/#solution_3","title":"Solution","text":"<pre><code>&lt;?php\n\n#[ORM\\Entity]\n#[ORM\\Index(name: 'idx_published_at', columns: ['published_at'])]\nclass Article\n{\n    #[ORM\\Column(type: 'datetime')]\n    private \\DateTimeInterface $publishedAt;\n}\n</code></pre>"},{"location":"examples/missing-indexes/#example-5-search-queries","title":"Example 5: Search Queries","text":""},{"location":"examples/missing-indexes/#problem-code_4","title":"Problem Code","text":"<pre><code>&lt;?php\n\npublic function search(string $term): array\n{\n    return $this-&gt;createQueryBuilder('a')\n        -&gt;where('a.title LIKE :term OR a.content LIKE :term')\n        -&gt;setParameter('term', '%' . $term . '%')\n        -&gt;getQuery()\n        -&gt;getResult();\n}\n</code></pre>"},{"location":"examples/missing-indexes/#doctrine-doctor-detection_4","title":"Doctrine Doctor Detection","text":"<pre><code>\ud83d\udfe1 Medium: LIKE Query Without Index\n\nWildcard searches with leading % cannot use indexes efficiently.\n\nSuggestions:\n1. Use full-text search index for MySQL\n2. Use PostgreSQL trigram indexes\n3. Consider Elasticsearch for complex searches\n</code></pre>"},{"location":"examples/missing-indexes/#solution-options","title":"Solution Options","text":""},{"location":"examples/missing-indexes/#option-1-mysql-full-text-index","title":"Option 1: MySQL Full-Text Index","text":"<pre><code>&lt;?php\n\n#[ORM\\Entity]\n#[ORM\\Index(name: 'idx_fulltext', columns: ['title', 'content'], flags: ['fulltext'])]\nclass Article\n{\n    #[ORM\\Column(type: 'string')]\n    private string $title;\n\n    #[ORM\\Column(type: 'text')]\n    private string $content;\n}\n</code></pre> <pre><code>&lt;?php\n\npublic function search(string $term): array\n{\n    return $this-&gt;createQueryBuilder('a')\n        -&gt;where('MATCH(a.title, a.content) AGAINST (:term IN BOOLEAN MODE) &gt; 0')\n        -&gt;setParameter('term', $term)\n        -&gt;getQuery()\n        -&gt;getResult();\n}\n</code></pre>"},{"location":"examples/missing-indexes/#option-2-postgresql-trigram","title":"Option 2: PostgreSQL Trigram","text":"<pre><code>CREATE EXTENSION IF NOT EXISTS pg_trgm;\nCREATE INDEX idx_title_trgm ON article USING gin (title gin_trgm_ops);\nCREATE INDEX idx_content_trgm ON article USING gin (content gin_trgm_ops);\n</code></pre>"},{"location":"examples/missing-indexes/#configuration","title":"Configuration","text":""},{"location":"examples/missing-indexes/#adjust-detection-thresholds","title":"Adjust Detection Thresholds","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        missing_index:\n            slow_query_threshold: 50      # Analyze queries slower than 50ms\n            min_rows_scanned: 1000        # Flag if scanning 1000+ rows\n            explain_queries: true         # Execute EXPLAIN (requires permissions)\n</code></pre>"},{"location":"examples/missing-indexes/#disable-for-specific-environments","title":"Disable for Specific Environments","text":"<pre><code># config/packages/test/doctrine_doctor.yaml\ndoctrine_doctor:\n    analyzers:\n        missing_index:\n            explain_queries: false  # Don't run EXPLAIN in tests\n</code></pre>"},{"location":"examples/missing-indexes/#performance-impact-examples","title":"Performance Impact Examples","text":""},{"location":"examples/missing-indexes/#small-table-1000-rows","title":"Small Table (&lt; 1,000 rows)","text":"<pre><code>Without index: 5ms\nWith index: 2ms\nImpact: Minimal\n</code></pre>"},{"location":"examples/missing-indexes/#medium-table-10000-100000-rows","title":"Medium Table (10,000 - 100,000 rows)","text":"<pre><code>Without index: 50-200ms\nWith index: 5-10ms\nImpact: 10-20x improvement\n</code></pre>"},{"location":"examples/missing-indexes/#large-table-1m-rows","title":"Large Table (1M+ rows)","text":"<pre><code>Without index: 2,000-10,000ms\nWith index: 10-50ms\nImpact: 100-500x improvement\n</code></pre>"},{"location":"examples/missing-indexes/#best-practices","title":"Best Practices","text":""},{"location":"examples/missing-indexes/#when-to-add-indexes","title":"When to Add Indexes","text":"<ol> <li>Foreign keys - Always index</li> <li>Frequent WHERE clauses - High priority</li> <li>ORDER BY columns - Important for sorting</li> <li>JOIN conditions - Critical for performance</li> </ol>"},{"location":"examples/missing-indexes/#when-not-to-add-indexes","title":"When NOT to Add Indexes","text":"<ol> <li>Rarely queried columns - Overhead not worth it</li> <li>High write frequency tables - Indexes slow down writes</li> <li>Small tables (&lt; 1,000 rows) - Full scans are fast enough</li> <li>Low cardinality columns (e.g., boolean) - Limited benefit</li> </ol>"},{"location":"examples/missing-indexes/#index-maintenance","title":"Index Maintenance","text":"<pre><code>-- Check index usage (MySQL)\nSHOW INDEX FROM article;\n\n-- Analyze table statistics\nANALYZE TABLE article;\n\n-- Remove unused indexes\nDROP INDEX idx_unused ON article;\n</code></pre>"},{"location":"examples/missing-indexes/#related-analyzers","title":"Related Analyzers","text":"<ul> <li>SlowQueryAnalyzer: Identifies slow queries that might need indexes</li> <li>JoinOptimizationAnalyzer: Suggests JOIN improvements</li> <li>FindAllAnalyzer: Detects missing LIMIT clauses that amplify index issues</li> </ul> <p>\u2190 N+1 Queries | Security Issues \u2192</p>"},{"location":"examples/n-plus-one/","title":"N+1 Query Detection Examples","text":"<p>Learn how to identify and fix N+1 query problems with Doctrine Doctor.</p>"},{"location":"examples/n-plus-one/#what-is-an-n1-query","title":"What is an N+1 Query?","text":"<p>An N+1 query problem occurs when:</p> <ol> <li>You execute 1 query to fetch N records</li> <li>Then execute N additional queries to fetch related data for each record</li> </ol> <p>Result: N+1 queries instead of 1-2 optimized queries.</p>"},{"location":"examples/n-plus-one/#example-1-basic-n1-in-templates","title":"Example 1: Basic N+1 in Templates","text":""},{"location":"examples/n-plus-one/#problem-code","title":"Problem Code","text":"<pre><code>&lt;?php\n// src/Controller/ArticleController.php\n\nnamespace App\\Controller;\n\nuse App\\Repository\\ArticleRepository;\nuse Symfony\\Bundle\\FrameworkBundle\\Controller\\AbstractController;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\Routing\\Annotation\\Route;\n\nclass ArticleController extends AbstractController\n{\n    #[Route('/articles', name: 'app_articles')]\n    public function index(ArticleRepository $articleRepository): Response\n    {\n        $articles = $articleRepository-&gt;findAll();  // 1 query\n\n        return $this-&gt;render('article/index.html.twig', [\n            'articles' =&gt; $articles,\n        ]);\n    }\n}\n</code></pre> <pre><code>{# templates/article/index.html.twig #}\n{% for article in articles %}\n    &lt;article&gt;\n        &lt;h2&gt;{{ article.title }}&lt;/h2&gt;\n        &lt;p&gt;By {{ article.author.name }}&lt;/p&gt;  {# +N queries! #}\n    &lt;/article&gt;\n{% endfor %}\n</code></pre>"},{"location":"examples/n-plus-one/#doctrine-doctor-detection","title":"Doctrine Doctor Detection","text":"<pre><code>\ud83d\udd34 Critical: N+1 Query Detected\n\nQuery executed 100 times:\nSELECT * FROM author WHERE id = ?\n\nSuggestion: Use eager loading with JOIN\n</code></pre>"},{"location":"examples/n-plus-one/#solution","title":"Solution","text":"<pre><code>&lt;?php\n\npublic function index(ArticleRepository $articleRepository): Response\n{\n    $articles = $articleRepository\n        -&gt;createQueryBuilder('a')\n        -&gt;leftJoin('a.author', 'author')\n        -&gt;addSelect('author')  // Eager load authors\n        -&gt;getQuery()\n        -&gt;getResult();\n\n    return $this-&gt;render('article/index.html.twig', [\n        'articles' =&gt; $articles,\n    ]);\n}\n</code></pre> <p>Result: 1 query with a JOIN instead of 101 queries.</p>"},{"location":"examples/n-plus-one/#example-2-nested-n1-queries","title":"Example 2: Nested N+1 Queries","text":""},{"location":"examples/n-plus-one/#problem-code_1","title":"Problem Code","text":"<pre><code>&lt;?php\n// Multiple levels of lazy loading\n\npublic function index(ArticleRepository $articleRepository): Response\n{\n    $articles = $articleRepository-&gt;findAll();\n\n    return $this-&gt;render('article/index.html.twig', [\n        'articles' =&gt; $articles,\n    ]);\n}\n</code></pre> <pre><code>{% for article in articles %}\n    &lt;article&gt;\n        &lt;h2&gt;{{ article.title }}&lt;/h2&gt;\n        &lt;p&gt;By {{ article.author.name }}&lt;/p&gt;\n        &lt;p&gt;From {{ article.author.country.name }}&lt;/p&gt;  {# Nested N+1! #}\n\n        &lt;h3&gt;Comments:&lt;/h3&gt;\n        {% for comment in article.comments %}  {# Another N+1! #}\n            &lt;p&gt;{{ comment.content }} - {{ comment.author.name }}&lt;/p&gt;  {# And another! #}\n        {% endfor %}\n    &lt;/article&gt;\n{% endfor %}\n</code></pre>"},{"location":"examples/n-plus-one/#doctrine-doctor-detection_1","title":"Doctrine Doctor Detection","text":"<pre><code>\ud83d\udd34 Critical: Nested N+1 Query Detected\n\nMultiple N+1 patterns detected:\n- article.author: 100 queries\n- author.country: 100 queries\n- article.comments: 100 queries\n- comment.author: 500 queries\n\nTotal: 801 queries instead of 1-2\n</code></pre>"},{"location":"examples/n-plus-one/#solution_1","title":"Solution","text":"<pre><code>&lt;?php\n\npublic function index(ArticleRepository $articleRepository): Response\n{\n    $articles = $articleRepository\n        -&gt;createQueryBuilder('a')\n        -&gt;leftJoin('a.author', 'author')\n        -&gt;leftJoin('author.country', 'country')\n        -&gt;leftJoin('a.comments', 'comments')\n        -&gt;leftJoin('comments.author', 'commentAuthor')\n        -&gt;addSelect('author', 'country', 'comments', 'commentAuthor')\n        -&gt;getQuery()\n        -&gt;getResult();\n\n    return $this-&gt;render('article/index.html.twig', [\n        'articles' =&gt; $articles,\n    ]);\n}\n</code></pre> <p>Result: 1 query with multiple JOINs.</p>"},{"location":"examples/n-plus-one/#example-3-n1-in-loops","title":"Example 3: N+1 in Loops","text":""},{"location":"examples/n-plus-one/#problem-code_2","title":"Problem Code","text":"<pre><code>&lt;?php\n\npublic function generateReport(ArticleRepository $articleRepository): Response\n{\n    $articles = $articleRepository-&gt;findAll();\n\n    $report = [];\n    foreach ($articles as $article) {\n        $report[] = [\n            'title' =&gt; $article-&gt;getTitle(),\n            'author' =&gt; $article-&gt;getAuthor()-&gt;getName(),  // N+1!\n            'comments_count' =&gt; $article-&gt;getComments()-&gt;count(),  // N+1!\n        ];\n    }\n\n    return $this-&gt;json($report);\n}\n</code></pre>"},{"location":"examples/n-plus-one/#solution_2","title":"Solution","text":"<pre><code>&lt;?php\n\npublic function generateReport(ArticleRepository $articleRepository): Response\n{\n    $articles = $articleRepository\n        -&gt;createQueryBuilder('a')\n        -&gt;leftJoin('a.author', 'author')\n        -&gt;leftJoin('a.comments', 'comments')\n        -&gt;addSelect('author', 'comments')\n        -&gt;getQuery()\n        -&gt;getResult();\n\n    $report = [];\n    foreach ($articles as $article) {\n        $report[] = [\n            'title' =&gt; $article-&gt;getTitle(),\n            'author' =&gt; $article-&gt;getAuthor()-&gt;getName(),\n            'comments_count' =&gt; $article-&gt;getComments()-&gt;count(),\n        ];\n    }\n\n    return $this-&gt;json($report);\n}\n</code></pre>"},{"location":"examples/n-plus-one/#example-4-collection-methods-triggering-n1","title":"Example 4: Collection Methods Triggering N+1","text":""},{"location":"examples/n-plus-one/#problem-code_3","title":"Problem Code","text":"<pre><code>&lt;?php\n\npublic function index(ArticleRepository $articleRepository): Response\n{\n    $articles = $articleRepository-&gt;findAll();\n\n    foreach ($articles as $article) {\n        // Each of these triggers a query!\n        if ($article-&gt;getComments()-&gt;isEmpty()) {  // Query!\n            continue;\n        }\n\n        $firstComment = $article-&gt;getComments()-&gt;first();  // Already loaded\n        $commentCount = $article-&gt;getComments()-&gt;count();  // No new query\n    }\n}\n</code></pre>"},{"location":"examples/n-plus-one/#solution_3","title":"Solution","text":"<p>Either eager load:</p> <pre><code>&lt;?php\n\n$articles = $articleRepository\n    -&gt;createQueryBuilder('a')\n    -&gt;leftJoin('a.comments', 'comments')\n    -&gt;addSelect('comments')\n    -&gt;getQuery()\n    -&gt;getResult();\n</code></pre> <p>Or use DQL for conditional logic:</p> <pre><code>&lt;?php\n\n$articles = $articleRepository\n    -&gt;createQueryBuilder('a')\n    -&gt;leftJoin('a.comments', 'c')\n    -&gt;having('COUNT(c.id) &gt; 0')  // Filter in database\n    -&gt;groupBy('a.id')\n    -&gt;getQuery()\n    -&gt;getResult();\n</code></pre>"},{"location":"examples/n-plus-one/#configuration-tips","title":"Configuration Tips","text":""},{"location":"examples/n-plus-one/#adjust-n1-sensitivity","title":"Adjust N+1 Sensitivity","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        n_plus_one:\n            threshold: 3  # Detect with 3+ duplicate queries\n</code></pre> <p>Recommended values:</p> <ul> <li>Development: <code>2</code> (strict)</li> <li>Team environment: <code>5</code> (balanced)</li> <li>Large codebase: <code>10</code> (focus on major issues)</li> </ul>"},{"location":"examples/n-plus-one/#performance-impact","title":"Performance Impact","text":""},{"location":"examples/n-plus-one/#before-fix","title":"Before Fix","text":"<pre><code>Queries: 501\nExecution time: 1,247ms\nMemory: 45MB\n</code></pre>"},{"location":"examples/n-plus-one/#after-fix","title":"After Fix","text":"<pre><code>Queries: 1\nExecution time: 23ms\nMemory: 8MB\n\nImprovement: 98% faster, 82% less memory\n</code></pre>"},{"location":"examples/n-plus-one/#related-analyzers","title":"Related Analyzers","text":"<ul> <li>NestedRelationshipN1Analyzer: Detects multi-level N+1 patterns</li> <li>LazyLoadingAnalyzer: Identifies excessive lazy loading</li> <li>SlowQueryAnalyzer: Finds slow queries that might indicate N+1</li> </ul> <p>\u2190 First Steps | Missing Indexes \u2192</p>"},{"location":"examples/security/","title":"Security Issue Detection Examples","text":"<p>Learn how Doctrine Doctor identifies security vulnerabilities in Doctrine ORM usage.</p>"},{"location":"examples/security/#security-analyzers-overview","title":"Security Analyzers Overview","text":"<p>Doctrine Doctor includes several security-focused analyzers:</p> <ul> <li>DQL Injection - Detects unsafe query construction</li> <li>SQL Injection - Identifies raw SQL vulnerabilities</li> <li>Sensitive Data Exposure - Finds unprotected sensitive fields</li> <li>Insecure Random - Detects weak random number generation</li> </ul>"},{"location":"examples/security/#example-1-dql-injection","title":"Example 1: DQL Injection","text":""},{"location":"examples/security/#problem-code","title":"Problem Code","text":"<pre><code>&lt;?php\n// src/Repository/UserRepository.php\n\npublic function findByUsername(string $username): ?User\n{\n    // DANGEROUS: Direct string concatenation\n    $dql = \"SELECT u FROM App\\Entity\\User u WHERE u.username = '\" . $username . \"'\";\n\n    return $this-&gt;getEntityManager()\n        -&gt;createQuery($dql)\n        -&gt;getOneOrNullResult();\n}\n</code></pre>"},{"location":"examples/security/#exploitation","title":"Exploitation","text":"<pre><code>&lt;?php\n// Attacker input\n$username = \"' OR '1'='1\";\n\n// Resulting DQL\n\"SELECT u FROM App\\Entity\\User u WHERE u.username = '' OR '1'='1'\"\n// Returns all users!\n</code></pre>"},{"location":"examples/security/#doctrine-doctor-detection","title":"Doctrine Doctor Detection","text":"<pre><code>\ud83d\udd34 Critical: DQL Injection Vulnerability\n\nQuery construction uses string concatenation with user input.\n\nQuery: SELECT u FROM App\\Entity\\User u WHERE u.username = '...'\n\nRisk: Attackers can modify query logic to access unauthorized data.\n\nBacktrace:\n- src/Repository/UserRepository.php:15\n- src/Controller/UserController.php:42\n</code></pre>"},{"location":"examples/security/#solution-use-parameter-binding","title":"Solution: Use Parameter Binding","text":"<pre><code>&lt;?php\n\npublic function findByUsername(string $username): ?User\n{\n    $dql = \"SELECT u FROM App\\Entity\\User u WHERE u.username = :username\";\n\n    return $this-&gt;getEntityManager()\n        -&gt;createQuery($dql)\n        -&gt;setParameter('username', $username)  // Safe parameterized query\n        -&gt;getOneOrNullResult();\n}\n</code></pre> <p>Or use QueryBuilder (recommended):</p> <pre><code>&lt;?php\n\npublic function findByUsername(string $username): ?User\n{\n    return $this-&gt;createQueryBuilder('u')\n        -&gt;where('u.username = :username')\n        -&gt;setParameter('username', $username)\n        -&gt;getQuery()\n        -&gt;getOneOrNullResult();\n}\n</code></pre>"},{"location":"examples/security/#example-2-sql-injection-in-native-queries","title":"Example 2: SQL Injection in Native Queries","text":""},{"location":"examples/security/#problem-code_1","title":"Problem Code","text":"<pre><code>&lt;?php\n// src/Repository/ProductRepository.php\n\npublic function searchProducts(string $category, string $sortBy): array\n{\n    $sql = \"SELECT * FROM product\n            WHERE category = '$category'\n            ORDER BY $sortBy\";  // DANGEROUS!\n\n    $conn = $this-&gt;getEntityManager()-&gt;getConnection();\n    return $conn-&gt;executeQuery($sql)-&gt;fetchAllAssociative();\n}\n</code></pre>"},{"location":"examples/security/#exploitation_1","title":"Exploitation","text":"<pre><code>&lt;?php\n// Attacker input\n$category = \"electronics' OR '1'='1\";\n$sortBy = \"price; DROP TABLE product--\";\n\n// Potential SQL injection and data destruction\n</code></pre>"},{"location":"examples/security/#doctrine-doctor-detection_1","title":"Doctrine Doctor Detection","text":"<pre><code>\ud83d\udd34 Critical: SQL Injection Vulnerability\n\nNative SQL query uses string concatenation with unescaped input.\n\nQuery: SELECT * FROM product WHERE category = '...' ORDER BY ...\n\nRisk: Direct SQL injection. Attacker can execute arbitrary SQL.\n\nRecommendation: Use prepared statements with parameter binding.\n</code></pre>"},{"location":"examples/security/#solution-parameterized-queries","title":"Solution: Parameterized Queries","text":"<pre><code>&lt;?php\n\npublic function searchProducts(string $category, string $sortBy): array\n{\n    // Whitelist allowed sort columns\n    $allowedSortColumns = ['name', 'price', 'created_at'];\n    if (!in_array($sortBy, $allowedSortColumns, true)) {\n        throw new \\InvalidArgumentException('Invalid sort column');\n    }\n\n    $sql = \"SELECT * FROM product\n            WHERE category = :category\n            ORDER BY \" . $sortBy;  // Safe: validated against whitelist\n\n    $conn = $this-&gt;getEntityManager()-&gt;getConnection();\n    return $conn-&gt;executeQuery($sql, ['category' =&gt; $category])\n        -&gt;fetchAllAssociative();\n}\n</code></pre> <p>Better solution with QueryBuilder:</p> <pre><code>&lt;?php\n\npublic function searchProducts(string $category, string $sortBy): array\n{\n    $allowedSortColumns = ['name', 'price', 'createdAt'];\n    if (!in_array($sortBy, $allowedSortColumns, true)) {\n        throw new \\InvalidArgumentException('Invalid sort column');\n    }\n\n    return $this-&gt;createQueryBuilder('p')\n        -&gt;where('p.category = :category')\n        -&gt;orderBy('p.' . $sortBy, 'ASC')\n        -&gt;setParameter('category', $category)\n        -&gt;getQuery()\n        -&gt;getResult();\n}\n</code></pre>"},{"location":"examples/security/#example-3-sensitive-data-exposure","title":"Example 3: Sensitive Data Exposure","text":""},{"location":"examples/security/#problem-code_2","title":"Problem Code","text":"<pre><code>&lt;?php\n// src/Entity/User.php\n\n#[ORM\\Entity]\nclass User implements \\JsonSerializable\n{\n    #[ORM\\Column(type: 'string')]\n    private string $password;  // Hashed\n\n    #[ORM\\Column(type: 'string', nullable: true)]\n    private ?string $ssn = null;  // Social Security Number\n\n    #[ORM\\Column(type: 'string', nullable: true)]\n    private ?string $creditCard = null;\n\n    // DANGEROUS: Exposes all fields\n    public function jsonSerialize(): mixed\n    {\n        return get_object_vars($this);\n    }\n}\n</code></pre>"},{"location":"examples/security/#doctrine-doctor-detection_2","title":"Doctrine Doctor Detection","text":"<pre><code>\ud83d\udd34 Critical: Sensitive Data Exposure\n\nEntity User implements JsonSerializable and exposes all properties.\n\nSensitive fields detected:\n- password (even if hashed, shouldn't be exposed)\n- ssn\n- creditCard\n\nRisk: Accidental exposure in API responses, logs, or serialization.\n\nRecommendation: Use explicit property whitelisting.\n</code></pre>"},{"location":"examples/security/#solution-whitelist-exposed-fields","title":"Solution: Whitelist Exposed Fields","text":"<pre><code>&lt;?php\n\n#[ORM\\Entity]\nclass User implements \\JsonSerializable\n{\n    #[ORM\\Column(type: 'string')]\n    private string $password;\n\n    #[ORM\\Column(type: 'string', nullable: true)]\n    private ?string $ssn = null;\n\n    #[ORM\\Column(type: 'string', nullable: true)]\n    private ?string $creditCard = null;\n\n    #[ORM\\Column(type: 'string')]\n    private string $email;\n\n    #[ORM\\Column(type: 'string')]\n    private string $username;\n\n    // Safe: Only expose non-sensitive fields\n    public function jsonSerialize(): mixed\n    {\n        return [\n            'id' =&gt; $this-&gt;id,\n            'username' =&gt; $this-&gt;username,\n            'email' =&gt; $this-&gt;email,\n            // Sensitive fields NOT included\n        ];\n    }\n}\n</code></pre> <p>Better: Use Symfony Serializer with Groups:</p> <pre><code>&lt;?php\n\nuse Symfony\\Component\\Serializer\\Annotation\\Groups;\n\n#[ORM\\Entity]\nclass User\n{\n    #[ORM\\Column(type: 'string')]\n    #[Groups(['user:read'])]\n    private string $username;\n\n    #[ORM\\Column(type: 'string')]\n    private string $password;  // No group = not serialized by default\n\n    #[ORM\\Column(type: 'string')]\n    private ?string $ssn = null;  // No group = not serialized\n}\n</code></pre>"},{"location":"examples/security/#example-4-insecure-random-token-generation","title":"Example 4: Insecure Random Token Generation","text":""},{"location":"examples/security/#problem-code_3","title":"Problem Code","text":"<pre><code>&lt;?php\n// src/Service/TokenGenerator.php\n\nclass TokenGenerator\n{\n    public function generateResetToken(): string\n    {\n        // INSECURE: Predictable randomness\n        return md5(uniqid(mt_rand(), true));\n    }\n\n    public function generateApiKey(): string\n    {\n        // INSECURE: time() is predictable\n        return hash('sha256', time() . rand());\n    }\n}\n</code></pre>"},{"location":"examples/security/#doctrine-doctor-detection_3","title":"Doctrine Doctor Detection","text":"<pre><code>\ud83d\udd34 Critical: Insecure Random Number Generation\n\nDetected use of weak random functions: mt_rand(), rand(), uniqid()\n\nContext: Token generation for security purposes\n\nRisk: Attackers can predict tokens and gain unauthorized access.\n\nRecommendation: Use random_bytes() or random_int() for security tokens.\n</code></pre>"},{"location":"examples/security/#solution-cryptographically-secure-random","title":"Solution: Cryptographically Secure Random","text":"<pre><code>&lt;?php\n\nclass TokenGenerator\n{\n    public function generateResetToken(): string\n    {\n        // Secure: Cryptographically strong randomness\n        return bin2hex(random_bytes(32));\n    }\n\n    public function generateApiKey(): string\n    {\n        // Secure: Using Symfony's random_bytes wrapper\n        return base64_encode(random_bytes(32));\n    }\n}\n</code></pre>"},{"location":"examples/security/#example-5-mass-assignment-vulnerability","title":"Example 5: Mass Assignment Vulnerability","text":""},{"location":"examples/security/#problem-code_4","title":"Problem Code","text":"<pre><code>&lt;?php\n// src/Controller/UserController.php\n\n#[Route('/api/users/{id}', methods: ['PUT'])]\npublic function update(Request $request, User $user, EntityManagerInterface $em): Response\n{\n    $data = json_decode($request-&gt;getContent(), true);\n\n    // DANGEROUS: Blindly updating all fields\n    foreach ($data as $key =&gt; $value) {\n        $setter = 'set' . ucfirst($key);\n        if (method_exists($user, $setter)) {\n            $user-&gt;$setter($value);\n        }\n    }\n\n    $em-&gt;flush();\n\n    return $this-&gt;json($user);\n}\n</code></pre>"},{"location":"examples/security/#attack-scenario","title":"Attack Scenario","text":"<pre><code># Attacker sends malicious payload\ncurl -X PUT /api/users/123 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"username\": \"newname\",\n    \"isAdmin\": true,      # Privilege escalation!\n    \"credits\": 999999      # Unauthorized balance modification\n  }'\n</code></pre>"},{"location":"examples/security/#doctrine-doctor-detection_4","title":"Doctrine Doctor Detection","text":"<pre><code>\ud83d\udfe0 High: Potential Mass Assignment Vulnerability\n\nController directly maps request data to entity properties without validation.\n\nRisk: Attackers can modify unintended fields (roles, permissions, balances).\n\nRecommendation: Use explicit DTO mapping or Form component.\n</code></pre>"},{"location":"examples/security/#solution-use-dtos-and-validation","title":"Solution: Use DTOs and Validation","text":"<pre><code>&lt;?php\n\n// src/Dto/UpdateUserDto.php\nclass UpdateUserDto\n{\n    #[Assert\\NotBlank]\n    #[Assert\\Length(min: 3, max: 50)]\n    public string $username;\n\n    #[Assert\\Email]\n    public string $email;\n\n    // Only allowed fields defined\n}\n</code></pre> <pre><code>&lt;?php\n// src/Controller/UserController.php\n\n#[Route('/api/users/{id}', methods: ['PUT'])]\npublic function update(\n    Request $request,\n    User $user,\n    ValidatorInterface $validator,\n    SerializerInterface $serializer,\n    EntityManagerInterface $em\n): Response {\n    // Deserialize to DTO\n    $dto = $serializer-&gt;deserialize(\n        $request-&gt;getContent(),\n        UpdateUserDto::class,\n        'json'\n    );\n\n    // Validate\n    $errors = $validator-&gt;validate($dto);\n    if (count($errors) &gt; 0) {\n        return $this-&gt;json($errors, 400);\n    }\n\n    // Explicit mapping - only allowed fields\n    $user-&gt;setUsername($dto-&gt;username);\n    $user-&gt;setEmail($dto-&gt;email);\n    // isAdmin, credits, etc. NOT modifiable\n\n    $em-&gt;flush();\n\n    return $this-&gt;json($user);\n}\n</code></pre>"},{"location":"examples/security/#security-configuration","title":"Security Configuration","text":"<p>All security analyzers should always be enabled:</p> <pre><code>doctrine_doctor:\n    analyzers:\n        dql_injection:\n            enabled: true  # Always on\n        sql_injection:\n            enabled: true  # Always on\n        sensitive_data_exposure:\n            enabled: true  # Always on\n        insecure_random:\n            enabled: true  # Always on\n</code></pre>"},{"location":"examples/security/#security-best-practices","title":"Security Best Practices","text":""},{"location":"examples/security/#1-never-trust-user-input","title":"1. Never Trust User Input","text":"<pre><code>// Bad\n$dql = \"SELECT u FROM User u WHERE u.role = '{$_GET['role']}'\";\n\n// Good\n$qb-&gt;where('u.role = :role')-&gt;setParameter('role', $_GET['role']);\n</code></pre>"},{"location":"examples/security/#2-use-parameterized-queries","title":"2. Use Parameterized Queries","text":"<pre><code>// Bad\n$em-&gt;createQuery(\"SELECT u FROM User u WHERE u.id = \" . $id);\n\n// Good\n$em-&gt;createQuery(\"SELECT u FROM User u WHERE u.id = :id\")\n   -&gt;setParameter('id', $id);\n</code></pre>"},{"location":"examples/security/#3-whitelist-dont-blacklist","title":"3. Whitelist, Don't Blacklist","text":"<pre><code>// Bad: Trying to block dangerous input\nif (str_contains($input, 'DROP') || str_contains($input, 'DELETE')) {\n    throw new Exception('Invalid input');\n}\n\n// Good: Only allow known-safe values\n$allowedColumns = ['name', 'email', 'created_at'];\nif (!in_array($column, $allowedColumns, true)) {\n    throw new InvalidArgumentException();\n}\n</code></pre>"},{"location":"examples/security/#4-use-framework-security-features","title":"4. Use Framework Security Features","text":"<pre><code>// Symfony Security for authorization\n#[IsGranted('ROLE_ADMIN')]\npublic function adminAction() { }\n\n// Symfony Validator for input validation\n#[Assert\\Email]\nprivate string $email;\n</code></pre>"},{"location":"examples/security/#related-resources","title":"Related Resources","text":"<ul> <li>OWASP Top 10</li> <li>Symfony Security Best Practices</li> <li>Doctrine Security</li> </ul> <p>\u2190 Missing Indexes | Contributing \u2192</p>"},{"location":"getting-started/first-steps/","title":"First Steps","text":"<p>Learn how to use Doctrine Doctor effectively in your Symfony project.</p>"},{"location":"getting-started/first-steps/#understanding-the-profiler-panel","title":"Understanding the Profiler Panel","text":"<p>The Doctrine Doctor panel appears in the Symfony Web Profiler toolbar after each request.</p>"},{"location":"getting-started/first-steps/#panel-overview","title":"Panel Overview","text":"<p>The panel displays:</p> <ul> <li>Issue count by severity (Critical, High, Medium, Low)</li> <li>Category breakdown (Performance, Security, Code Quality, Configuration)</li> <li>Total queries analyzed</li> <li>Analysis time (overhead)</li> </ul>"},{"location":"getting-started/first-steps/#reading-issue-reports","title":"Reading Issue Reports","text":"<p>Each issue contains:</p>"},{"location":"getting-started/first-steps/#1-title-and-severity","title":"1. Title and Severity","text":"<pre><code>\ud83d\udd34 Critical: N+1 Query Detected\n</code></pre>"},{"location":"getting-started/first-steps/#2-description","title":"2. Description","text":"<p>Detailed explanation of the problem and its impact.</p>"},{"location":"getting-started/first-steps/#3-affected-queries","title":"3. Affected Queries","text":"<p>The specific SQL queries involved:</p> <pre><code>SELECT * FROM user WHERE id = ?\n-- Executed 100 times\n</code></pre>"},{"location":"getting-started/first-steps/#4-backtrace-if-enabled","title":"4. Backtrace (if enabled)","text":"<p>Code location where the query originated:</p> <pre><code>src/Controller/UserController.php:42\ntemplates/user/index.html.twig:15\n</code></pre>"},{"location":"getting-started/first-steps/#5-suggestion","title":"5. Suggestion","text":"<p>Actionable solution with code example:</p> <pre><code>$users = $repository\n    -&gt;createQueryBuilder('u')\n    -&gt;leftJoin('u.profile', 'p')\n    -&gt;addSelect('p')\n    -&gt;getQuery()\n    -&gt;getResult();\n</code></pre>"},{"location":"getting-started/first-steps/#common-workflow","title":"Common Workflow","text":""},{"location":"getting-started/first-steps/#1-develop-as-normal","title":"1. Develop as Normal","text":"<p>Write your Symfony code without worrying about Doctrine Doctor.</p>"},{"location":"getting-started/first-steps/#2-check-the-profiler","title":"2. Check the Profiler","text":"<p>After loading a page, click the Doctrine Doctor panel in the profiler.</p>"},{"location":"getting-started/first-steps/#3-review-issues","title":"3. Review Issues","text":"<p>Focus on Critical and High severity issues first.</p>"},{"location":"getting-started/first-steps/#4-apply-suggestions","title":"4. Apply Suggestions","text":"<p>Use the provided code examples to fix issues.</p>"},{"location":"getting-started/first-steps/#5-verify-fix","title":"5. Verify Fix","text":"<p>Refresh the page and confirm the issue is resolved.</p>"},{"location":"getting-started/first-steps/#configuring-analyzers","title":"Configuring Analyzers","text":"<p>Customize analyzer behavior in <code>config/packages/dev/doctrine_doctor.yaml</code>:</p>"},{"location":"getting-started/first-steps/#example-stricter-n1-detection","title":"Example: Stricter N+1 Detection","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        n_plus_one:\n            threshold: 2  # Detect even minor N+1 issues\n</code></pre>"},{"location":"getting-started/first-steps/#example-adjust-slow-query-threshold","title":"Example: Adjust Slow Query Threshold","text":"<pre><code>doctrine_doctor:\n    analyzers:\n        slow_query:\n            threshold: 50  # Flag queries over 50ms\n</code></pre> <p>See full configuration reference \u2192</p>"},{"location":"getting-started/first-steps/#best-practices","title":"Best Practices","text":""},{"location":"getting-started/first-steps/#during-development","title":"During Development","text":"<ol> <li>Keep Doctrine Doctor enabled in the dev environment</li> <li>Enable backtraces for precise issue location</li> <li>Review issues regularly before committing code</li> <li>Fix Critical/High issues immediately</li> </ol>"},{"location":"getting-started/first-steps/#before-deployment","title":"Before Deployment","text":"<ol> <li>Run tests to ensure fixes don't break functionality</li> <li>Review staging environment with production-like data</li> <li>Ensure Doctrine Doctor is disabled in production</li> </ol>"},{"location":"getting-started/first-steps/#team-collaboration","title":"Team Collaboration","text":"<ol> <li>Share configuration via version control</li> <li>Document common patterns your team encounters</li> <li>Set team standards for acceptable thresholds</li> <li>Review issues in code reviews</li> </ol>"},{"location":"getting-started/first-steps/#understanding-severity-levels","title":"Understanding Severity Levels","text":""},{"location":"getting-started/first-steps/#critical","title":"\ud83d\udd34 Critical","text":"<ul> <li>Security vulnerabilities (SQL injection)</li> <li>Data loss risk (cascade misconfiguration)</li> <li>Major performance issues (100+ N+1 queries)</li> </ul> <p>Action: Fix immediately before committing</p>"},{"location":"getting-started/first-steps/#high","title":"\ud83d\udfe0 High","text":"<ul> <li>Significant performance degradation (missing indexes)</li> <li>Architectural violations</li> <li>Major inefficiencies</li> </ul> <p>Action: Fix before merging to main branch</p>"},{"location":"getting-started/first-steps/#medium","title":"\ud83d\udfe1 Medium","text":"<ul> <li>Sub-optimal patterns</li> <li>Minor performance issues</li> <li>Code quality improvements</li> </ul> <p>Action: Fix when refactoring or improving the area</p>"},{"location":"getting-started/first-steps/#low","title":"\ud83d\udd35 Low","text":"<ul> <li>Naming conventions</li> <li>Minor suggestions</li> <li>Cosmetic issues</li> </ul> <p>Action: Fix when convenient or as part of larger changes</p>"},{"location":"getting-started/first-steps/#next-steps","title":"Next Steps","text":"<ul> <li>Explore common examples</li> <li>Learn about all analyzers</li> <li>Understand the architecture</li> <li>Customize configuration</li> </ul> <p>\u2190 Installation | Examples \u2192</p>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>Detailed installation guide for Doctrine Doctor.</p>"},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>PHP: 8.2 or higher</li> <li>Symfony: 6.0+ or 7.x</li> <li>Doctrine ORM: 2.10+, 3.x, or 4.x</li> </ul>"},{"location":"getting-started/installation/#install-via-composer","title":"Install via Composer","text":"<pre><code>composer require --dev ahmed-bhs/doctrine-doctor\n</code></pre> <p>Development Only</p> <p>Always install Doctrine Doctor as a development dependency (<code>--dev</code>). Never use it in production.</p>"},{"location":"getting-started/installation/#symfony-flex-auto-configuration","title":"Symfony Flex Auto-Configuration","text":"<p>If you're using Symfony Flex, the bundle is automatically configured. The recipe creates:</p> <pre><code>config/\n\u2514\u2500\u2500 packages/\n    \u2514\u2500\u2500 dev/\n        \u2514\u2500\u2500 doctrine_doctor.yaml\n</code></pre> <p>with default configuration:</p> <pre><code>doctrine_doctor:\n    enabled: true\n</code></pre>"},{"location":"getting-started/installation/#manual-configuration-without-flex","title":"Manual Configuration (Without Flex)","text":"<p>If you're not using Symfony Flex, register the bundle manually:</p> <pre><code>&lt;?php\n// config/bundles.php\n\nreturn [\n    // ...\n    AhmedBhs\\DoctrineDoctor\\DoctrineDoctorBundle::class =&gt; ['dev' =&gt; true],\n];\n</code></pre> <p>Then create the configuration file:</p> <pre><code># config/packages/dev/doctrine_doctor.yaml\ndoctrine_doctor:\n    enabled: true\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<p>Check that the bundle is loaded:</p> <pre><code>php bin/console debug:container --parameter=kernel.bundles\n</code></pre> <p>You should see <code>DoctrineDoctorBundle</code> in the list.</p>"},{"location":"getting-started/installation/#enable-backtraces-optional-but-recommended","title":"Enable Backtraces (Optional but Recommended)","text":"<p>To see code location backtraces in issue reports:</p> <pre><code># config/packages/dev/doctrine.yaml\ndoctrine:\n    dbal:\n        profiling_collect_backtrace: true\n</code></pre>"},{"location":"getting-started/installation/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/installation/#bundle-not-showing-in-profiler","title":"Bundle Not Showing in Profiler","text":"<ol> <li>Check environment: Ensure you're in <code>dev</code> environment</li> <li>Clear cache: Run <code>php bin/console cache:clear</code></li> <li>Check bundle registration: Verify bundle is in <code>config/bundles.php</code> with <code>['dev' =&gt; true]</code></li> </ol>"},{"location":"getting-started/installation/#no-issues-detected","title":"No Issues Detected","text":"<ol> <li>Execute queries: Make sure your page executes database queries</li> <li>Check configuration: Verify <code>doctrine_doctor.enabled</code> is <code>true</code></li> <li>Review thresholds: Some analyzers might have high thresholds</li> </ol>"},{"location":"getting-started/installation/#permission-issues","title":"Permission Issues","text":"<p>If using the Missing Index Analyzer, ensure your database user has <code>SELECT</code> permissions to execute <code>EXPLAIN</code> queries.</p>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Guide</li> <li>First Steps</li> <li>Configuration Reference</li> </ul> <p>\u2190 Quick Start | First Steps \u2192</p>"},{"location":"getting-started/quick-start/","title":"Quick Start","text":"<p>Get Doctrine Doctor running in your Symfony project in under 30 seconds.</p>"},{"location":"getting-started/quick-start/#installation","title":"Installation","text":"<p>Install via Composer:</p> <pre><code>composer require --dev ahmed-bhs/doctrine-doctor\n</code></pre> <p>Auto-Configuration</p> <p>Doctrine Doctor is automatically configured via Symfony Flex. No manual setup required!</p>"},{"location":"getting-started/quick-start/#verify-installation","title":"Verify Installation","text":"<ol> <li>Refresh any page in your Symfony application (in <code>dev</code> environment)</li> <li>Open the Symfony Web Profiler (bottom toolbar)</li> <li>Look for the \"Doctrine Doctor\" panel \ud83e\ude7a</li> </ol>"},{"location":"getting-started/quick-start/#first-analysis","title":"First Analysis","text":"<p>Doctrine Doctor automatically analyzes all database queries executed during your request.</p>"},{"location":"getting-started/quick-start/#example-detect-n1-query","title":"Example: Detect N+1 Query","text":"<p>Create a simple controller:</p> <pre><code>&lt;?php\n\nnamespace App\\Controller;\n\nuse App\\Repository\\UserRepository;\nuse Symfony\\Bundle\\FrameworkBundle\\Controller\\AbstractController;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\Routing\\Annotation\\Route;\n\nclass UserController extends AbstractController\n{\n    #[Route('/users', name: 'app_users')]\n    public function index(UserRepository $userRepository): Response\n    {\n        $users = $userRepository-&gt;findAll();\n\n        return $this-&gt;render('user/index.html.twig', [\n            'users' =&gt; $users,\n        ]);\n    }\n}\n</code></pre> <p>And a Twig template:</p> <pre><code>{# templates/user/index.html.twig #}\n{% for user in users %}\n    &lt;p&gt;{{ user.name }} - {{ user.profile.bio }}&lt;/p&gt;\n{% endfor %}\n</code></pre> <p>Result: Doctrine Doctor will detect the N+1 query issue and suggest using eager loading!</p>"},{"location":"getting-started/quick-start/#enable-backtraces-recommended","title":"Enable Backtraces (Recommended)","text":"<p>To see exactly WHERE in your code issues originate, enable query backtraces:</p> <pre><code># config/packages/dev/doctrine.yaml\ndoctrine:\n    dbal:\n        profiling_collect_backtrace: true\n</code></pre> <p>Performance Impact</p> <p>Backtrace collection has minimal overhead (~2-5%) and is recommended for development.</p>"},{"location":"getting-started/quick-start/#next-steps","title":"Next Steps","text":"<ul> <li>Configure analyzers to match your needs</li> <li>Explore all 66 analyzers available</li> <li>Learn about the architecture</li> <li>See more examples</li> </ul> <p>\u2190 Back to Home | Installation Details \u2192</p>"}]}